import{t as bt,e as lt}from"./tslib.db062970.js";import{g as Qo,r as ec}from"./index.cfaf5393.js";import{e as zi,c as Hi,s as qi,a as Bi,d as Ki,g as tc,h as rc,i as Zn,j as Is,b as ic,k as sc,l as Qn,f as Vi,m as nc,J as _r,n as Gi,o as ki,q as Pt,r as It,t as ea,u as Wi,H as Gr}from"./index.c25e59d9.js";function ac(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var oc=cc;function cc(t,e,r){var i=r&&r.stringify||ac,s=1;if(typeof t=="object"&&t!==null){var c=e.length+s;if(c===1)return t;var p=new Array(c);p[0]=i(t);for(var h=1;h<c;h++)p[h]=i(e[h]);return p.join(" ")}if(typeof t!="string")return t;var f=e.length;if(f===0)return t;for(var _="",m=1-s,E=-1,N=t&&t.length||0,v=0;v<N;){if(t.charCodeAt(v)===37&&v+1<N){switch(E=E>-1?E:0,t.charCodeAt(v+1)){case 100:case 102:if(m>=f||e[m]==null)break;E<v&&(_+=t.slice(E,v)),_+=Number(e[m]),E=v+2,v++;break;case 105:if(m>=f||e[m]==null)break;E<v&&(_+=t.slice(E,v)),_+=Math.floor(Number(e[m])),E=v+2,v++;break;case 79:case 111:case 106:if(m>=f||e[m]===void 0)break;E<v&&(_+=t.slice(E,v));var D=typeof e[m];if(D==="string"){_+="'"+e[m]+"'",E=v+2,v++;break}if(D==="function"){_+=e[m].name||"<anonymous>",E=v+2,v++;break}_+=i(e[m]),E=v+2,v++;break;case 115:if(m>=f)break;E<v&&(_+=t.slice(E,v)),_+=String(e[m]),E=v+2,v++;break;case 37:E<v&&(_+=t.slice(E,v)),_+="%",E=v+2,v++,m--;break}++m}++v}return E===-1?t:(E<N&&(_+=t.slice(E)),_)}const Os=oc;var wr=vt;const yr=mc().console||{},hc={mapHttpRequest:Fr,mapHttpResponse:Fr,wrapRequestSerializer:ni,wrapResponseSerializer:ni,wrapErrorSerializer:ni,req:Fr,res:Fr,err:pc};function uc(t,e){return Array.isArray(t)?t.filter(function(i){return i!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function vt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||yr;t.browser.write&&(t.browser.asObject=!0);const i=t.serializers||{},s=uc(t.browser.serialize,i);let c=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);const p=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const h=t.level||"info",f=Object.create(r);f.log||(f.log=br),Object.defineProperty(f,"levelVal",{get:m}),Object.defineProperty(f,"level",{get:E,set:N});const _={transmit:e,serialize:s,asObject:t.browser.asObject,levels:p,timestamp:gc(t)};f.levels=vt.levels,f.level=h,f.setMaxListeners=f.getMaxListeners=f.emit=f.addListener=f.on=f.prependListener=f.once=f.prependOnceListener=f.removeListener=f.removeAllListeners=f.listeners=f.listenerCount=f.eventNames=f.write=f.flush=br,f.serializers=i,f._serialize=s,f._stdErrSerialize=c,f.child=v,e&&(f._logEvent=Di());function m(){return this.level==="silent"?1/0:this.levels.values[this.level]}function E(){return this._level}function N(D){if(D!=="silent"&&!this.levels.values[D])throw Error("unknown level "+D);this._level=D,Wt(_,f,"error","log"),Wt(_,f,"fatal","error"),Wt(_,f,"warn","error"),Wt(_,f,"info","log"),Wt(_,f,"debug","log"),Wt(_,f,"trace","log")}function v(D,U){if(!D)throw new Error("missing bindings for child Pino");U=U||{},s&&D.serializers&&(U.serializers=D.serializers);const I=U.serializers;if(s&&I){var R=Object.assign({},i,I),o=t.browser.serialize===!0?Object.keys(R):s;delete D.serializers,kr([D],o,R,this._stdErrSerialize)}function d(u){this._childLevel=(u._childLevel|0)+1,this.error=Yt(u,D,"error"),this.fatal=Yt(u,D,"fatal"),this.warn=Yt(u,D,"warn"),this.info=Yt(u,D,"info"),this.debug=Yt(u,D,"debug"),this.trace=Yt(u,D,"trace"),R&&(this.serializers=R,this._serialize=o),e&&(this._logEvent=Di([].concat(u._logEvent.bindings,D)))}return d.prototype=this,new d(this)}return f}vt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};vt.stdSerializers=hc;vt.stdTimeFunctions=Object.assign({},{nullTime:ta,epochTime:ra,unixTime:yc,isoTime:bc});function Wt(t,e,r,i){const s=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?br:s[r]?s[r]:yr[r]||yr[i]||br,lc(t,e,r)}function lc(t,e,r){!t.transmit&&e[r]===br||(e[r]=function(i){return function(){const c=t.timestamp(),p=new Array(arguments.length),h=Object.getPrototypeOf&&Object.getPrototypeOf(this)===yr?yr:this;for(var f=0;f<p.length;f++)p[f]=arguments[f];if(t.serialize&&!t.asObject&&kr(p,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?i.call(h,fc(this,r,p,c)):i.apply(h,p),t.transmit){const _=t.transmit.level||e.level,m=vt.levels.values[_],E=vt.levels.values[r];if(E<m)return;dc(this,{ts:c,methodLevel:r,methodValue:E,transmitLevel:_,transmitValue:vt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},p)}}}(e[r]))}function fc(t,e,r,i){t._serialize&&kr(r,t._serialize,t.serializers,t._stdErrSerialize);const s=r.slice();let c=s[0];const p={};i&&(p.time=i),p.level=vt.levels.values[e];let h=(t._childLevel|0)+1;if(h<1&&(h=1),c!==null&&typeof c=="object"){for(;h--&&typeof s[0]=="object";)Object.assign(p,s.shift());c=s.length?Os(s.shift(),s):void 0}else typeof c=="string"&&(c=Os(s.shift(),s));return c!==void 0&&(p.msg=c),p}function kr(t,e,r,i){for(const s in t)if(i&&t[s]instanceof Error)t[s]=vt.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const c in t[s])e&&e.indexOf(c)>-1&&c in r&&(t[s][c]=r[c](t[s][c]))}function Yt(t,e,r){return function(){const i=new Array(1+arguments.length);i[0]=e;for(var s=1;s<i.length;s++)i[s]=arguments[s-1];return t[r].apply(this,i)}}function dc(t,e,r){const i=e.send,s=e.ts,c=e.methodLevel,p=e.methodValue,h=e.val,f=t._logEvent.bindings;kr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(_){return f.indexOf(_)===-1}),t._logEvent.level.label=c,t._logEvent.level.value=p,i(c,t._logEvent,h),t._logEvent=Di(f)}function Di(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function pc(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function gc(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?ta:ra}function Fr(){return{}}function ni(t){return t}function br(){}function ta(){return!1}function ra(){return Date.now()}function yc(){return Math.round(Date.now()/1e3)}function bc(){return new Date(Date.now()).toISOString()}function mc(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}var Wr={},Er={};Object.defineProperty(Er,"__esModule",{value:!0});function _c(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Er.safeJsonParse=_c;function wc(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Er.safeJsonStringify=wc;var nr={exports:{}},As;function Ec(){return As||(As=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof globalThis<"u"&&globalThis.localStorage?nr.exports=globalThis.localStorage:typeof window<"u"&&window.localStorage?nr.exports=window.localStorage:nr.exports=new e}()),nr.exports}var ai={},ar={},Ns;function vc(){if(Ns)return ar;Ns=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.IKeyValueStorage=void 0;class t{}return ar.IKeyValueStorage=t,ar}var or={},Ts;function Dc(){if(Ts)return or;Ts=1,Object.defineProperty(or,"__esModule",{value:!0}),or.parseEntry=void 0;const t=Er;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return or.parseEntry=e,or}var Cs;function Sc(){return Cs||(Cs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(vc(),t),e.__exportStar(Dc(),t)}(ai)),ai}Object.defineProperty(Wr,"__esModule",{value:!0});Wr.KeyValueStorage=void 0;const Qt=bt.exports,Ps=Er,xc=Qt.__importDefault(Ec()),Ic=Sc();class ia{constructor(){this.localStorage=xc.default}getKeys(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return Qt.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Ic.parseEntry)})}getItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return Ps.safeJsonParse(r)})}setItem(e,r){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,Ps.safeJsonStringify(r))})}removeItem(e){return Qt.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Wr.KeyValueStorage=ia;var Oc=Wr.default=ia,vr={},cr={},J={},oi={},hr={},Us;function Ac(){if(Us)return hr;Us=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return hr.delay=t,hr}var Ht={},ci={},qt={},Rs;function Nc(){return Rs||(Rs=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.ONE_THOUSAND=qt.ONE_HUNDRED=void 0,qt.ONE_HUNDRED=100,qt.ONE_THOUSAND=1e3),qt}var hi={},Fs;function Tc(){return Fs||(Fs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(hi)),hi}var Ms;function sa(){return Ms||(Ms=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Nc(),t),e.__exportStar(Tc(),t)}(ci)),ci}var Ls;function Cc(){if(Ls)return Ht;Ls=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.fromMiliseconds=Ht.toMiliseconds=void 0;const t=sa();function e(i){return i*t.ONE_THOUSAND}Ht.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Ht.fromMiliseconds=r,Ht}var $s;function Pc(){return $s||($s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Ac(),t),e.__exportStar(Cc(),t)}(oi)),oi}var Jt={},js;function Uc(){if(js)return Jt;js=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Jt.Watch=t,Jt.default=t,Jt}var ui={},ur={},zs;function Rc(){if(zs)return ur;zs=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.IWatch=void 0;class t{}return ur.IWatch=t,ur}var Hs;function Fc(){return Hs||(Hs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),bt.exports.__exportStar(Rc(),t)}(ui)),ui}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(Pc(),t),e.__exportStar(Uc(),t),e.__exportStar(Fc(),t),e.__exportStar(sa(),t)})(J);var li={},lr={};class Gt{}const Mc=Object.freeze(Object.defineProperty({__proto__:null,IEvents:Gt},Symbol.toStringTag,{value:"Module"})),Lc=Qo(Mc);var qs;function $c(){if(qs)return lr;qs=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.IHeartBeat=void 0;const t=Lc;class e extends t.IEvents{constructor(i){super()}}return lr.IHeartBeat=e,lr}var Bs;function na(){return Bs||(Bs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),bt.exports.__exportStar($c(),t)}(li)),li}var fi={},Bt={},Ks;function jc(){if(Ks)return Bt;Ks=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.HEARTBEAT_EVENTS=Bt.HEARTBEAT_INTERVAL=void 0;const t=J;return Bt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Bt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Bt}var Vs;function aa(){return Vs||(Vs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),bt.exports.__exportStar(jc(),t)}(fi)),fi}var Gs;function zc(){if(Gs)return cr;Gs=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.HeartBeat=void 0;const t=bt.exports,e=lt.exports,r=J,i=na(),s=aa();class c extends i.IHeartBeat{constructor(h){super(h),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(h==null?void 0:h.interval)||s.HEARTBEAT_INTERVAL}static init(h){return t.__awaiter(this,void 0,void 0,function*(){const f=new c(h);return yield f.init(),f})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(h,f){this.events.on(h,f)}once(h,f){this.events.once(h,f)}off(h,f){this.events.off(h,f)}removeListener(h,f){this.events.removeListener(h,f)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return cr.HeartBeat=c,cr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=bt.exports;e.__exportStar(zc(),t),e.__exportStar(na(),t),e.__exportStar(aa(),t)})(vr);var Se={},Kt={},ks;function oa(){return ks||(ks=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.PINO_CUSTOM_CONTEXT_KEY=Kt.PINO_LOGGER_DEFAULTS=void 0,Kt.PINO_LOGGER_DEFAULTS={level:"info"},Kt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Kt}var tt={},Ws;function Hc(){if(Ws)return tt;Ws=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.generateChildLogger=tt.formatChildLoggerContext=tt.getLoggerContext=tt.setBrowserLoggerContext=tt.getBrowserLoggerContext=tt.getDefaultLoggerOptions=void 0;const t=oa();function e(h){return Object.assign(Object.assign({},h),{level:(h==null?void 0:h.level)||t.PINO_LOGGER_DEFAULTS.level})}tt.getDefaultLoggerOptions=e;function r(h,f=t.PINO_CUSTOM_CONTEXT_KEY){return h[f]||""}tt.getBrowserLoggerContext=r;function i(h,f,_=t.PINO_CUSTOM_CONTEXT_KEY){return h[_]=f,h}tt.setBrowserLoggerContext=i;function s(h,f=t.PINO_CUSTOM_CONTEXT_KEY){let _="";return typeof h.bindings>"u"?_=r(h,f):_=h.bindings().context||"",_}tt.getLoggerContext=s;function c(h,f,_=t.PINO_CUSTOM_CONTEXT_KEY){const m=s(h,_);return m.trim()?`${m}/${f}`:f}tt.formatChildLoggerContext=c;function p(h,f,_=t.PINO_CUSTOM_CONTEXT_KEY){const m=c(h,f,_),E=h.child({context:m});return i(E,m,_)}return tt.generateChildLogger=p,tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=bt.exports,r=e.__importDefault(wr);Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(oa(),t),e.__exportStar(Hc(),t)})(Se);class qc extends Gt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class Bc extends Gt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class Kc{constructor(e,r){this.logger=e,this.core=r}}class Vc extends Gt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Gc extends Gt{constructor(e){super()}}class kc{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}}class Wc extends Gt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Yc extends Gt{constructor(e,r){super(),this.core=e,this.logger=r}}var Yi={},er={},Yr={},Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.BrowserRandomSource=void 0;const Ys=65536;class Jc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Ys)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Ys)));return r}}Jr.BrowserRandomSource=Jc;function Xc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Xr={},ot={};Object.defineProperty(ot,"__esModule",{value:!0});function Zc(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ot.wipe=Zc;Object.defineProperty(Xr,"__esModule",{value:!0});Xr.NodeRandomSource=void 0;const Qc=ot;class eh{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Xc<"u"){const e=ec;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,Qc.wipe)(r),i}}Xr.NodeRandomSource=eh;Object.defineProperty(Yr,"__esModule",{value:!0});Yr.SystemRandomSource=void 0;const th=Jr,rh=Xr;class ih{constructor(){if(this.isAvailable=!1,this.name="",this._source=new th.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new rh.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Yr.SystemRandomSource=ih;var re={},ca={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(h,f){var _=h>>>16&65535,m=h&65535,E=f>>>16&65535,N=f&65535;return m*N+(_*N+m*E<<16>>>0)|0}t.mul=Math.imul||e;function r(h,f){return h+f|0}t.add=r;function i(h,f){return h-f|0}t.sub=i;function s(h,f){return h<<f|h>>>32-f}t.rotl=s;function c(h,f){return h<<32-f|h>>>f}t.rotr=c;function p(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h}t.isInteger=Number.isInteger||p,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(h){return t.isInteger(h)&&h>=-t.MAX_SAFE_INTEGER&&h<=t.MAX_SAFE_INTEGER}})(ca);Object.defineProperty(re,"__esModule",{value:!0});var ha=ca;function sh(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=sh;function nh(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=nh;function ah(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=ah;function oh(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=oh;function ua(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=ua;re.writeInt16BE=ua;function la(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=la;re.writeInt16LE=la;function Si(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=Si;function xi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=xi;function Ii(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=Ii;function Oi(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=Oi;function zr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=zr;re.writeInt32BE=zr;function Hr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=Hr;re.writeInt32LE=Hr;function ch(t,e){e===void 0&&(e=0);var r=Si(t,e),i=Si(t,e+4);return r*4294967296+i-(i>>31)*4294967296}re.readInt64BE=ch;function hh(t,e){e===void 0&&(e=0);var r=xi(t,e),i=xi(t,e+4);return r*4294967296+i}re.readUint64BE=hh;function uh(t,e){e===void 0&&(e=0);var r=Ii(t,e),i=Ii(t,e+4);return i*4294967296+r-(r>>31)*4294967296}re.readInt64LE=uh;function lh(t,e){e===void 0&&(e=0);var r=Oi(t,e),i=Oi(t,e+4);return i*4294967296+r}re.readUint64LE=lh;function fa(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),zr(t/4294967296>>>0,e,r),zr(t>>>0,e,r+4),e}re.writeUint64BE=fa;re.writeInt64BE=fa;function da(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Hr(t>>>0,e,r),Hr(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=da;re.writeInt64LE=da;function fh(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,c=t/8+r-1;c>=r;c--)i+=e[c]*s,s*=256;return i}re.readUintBE=fh;function dh(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,c=r;c<r+t/8;c++)i+=e[c]*s,s*=256;return i}re.readUintLE=dh;function ph(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!ha.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,c=t/8+i-1;c>=i;c--)r[c]=e/s&255,s*=256;return r}re.writeUintBE=ph;function gh(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!ha.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,c=i;c<i+t/8;c++)r[c]=e/s&255,s*=256;return r}re.writeUintLE=gh;function yh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=yh;function bh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=bh;function mh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=mh;function _h(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=_h;function wh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}re.writeFloat32BE=wh;function Eh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}re.writeFloat32LE=Eh;function vh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}re.writeFloat64BE=vh;function Dh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}re.writeFloat64LE=Dh;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Yr,r=re,i=ot;t.defaultRandomSource=new e.SystemRandomSource;function s(_,m=t.defaultRandomSource){return m.randomBytes(_)}t.randomBytes=s;function c(_=t.defaultRandomSource){const m=s(4,_),E=(0,r.readUint32LE)(m);return(0,i.wipe)(m),E}t.randomUint32=c;const p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function h(_,m=p,E=t.defaultRandomSource){if(m.length<2)throw new Error("randomString charset is too short");if(m.length>256)throw new Error("randomString charset is too long");let N="";const v=m.length,D=256-256%v;for(;_>0;){const U=s(Math.ceil(_*256/D),E);for(let I=0;I<U.length&&_>0;I++){const R=U[I];R<D&&(N+=m.charAt(R%v),_--)}(0,i.wipe)(U)}return N}t.randomString=h;function f(_,m=p,E=t.defaultRandomSource){const N=Math.ceil(_/(Math.log(m.length)/Math.LN2));return h(N,m,E)}t.randomStringForEntropy=f})(er);var pa={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ot;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function h(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},h.prototype.update=function(f,_){if(_===void 0&&(_=f.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var m=0;if(this._bytesHashed+=_,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&_>0;)this._buffer[this._bufferLength++]=f[m++],_--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(_>=this.blockSize&&(m=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,f,m,_),_%=this.blockSize);_>0;)this._buffer[this._bufferLength++]=f[m++],_--;return this},h.prototype.finish=function(f){if(!this._finished){var _=this._bytesHashed,m=this._bufferLength,E=_/536870912|0,N=_<<3,v=_%128<112?128:256;this._buffer[m]=128;for(var D=m+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(N,this._buffer,v-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/8;D++)e.writeUint32BE(this._stateHi[D],f,D*8),e.writeUint32BE(this._stateLo[D],f,D*8+4);return this},h.prototype.digest=function(){var f=new Uint8Array(this.digestLength);return this.finish(f),f},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(f){return this._stateHi.set(f.stateHi),this._stateLo.set(f.stateLo),this._bufferLength=f.bufferLength,f.buffer&&this._buffer.set(f.buffer),this._bytesHashed=f.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(f){r.wipe(f.stateHi),r.wipe(f.stateLo),f.buffer&&r.wipe(f.buffer),f.bufferLength=0,f.bytesHashed=0},h}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(h,f,_,m,E,N,v){for(var D=_[0],U=_[1],I=_[2],R=_[3],o=_[4],d=_[5],u=_[6],l=_[7],y=m[0],n=m[1],g=m[2],P=m[3],j=m[4],W=m[5],Y=m[6],X=m[7],C,T,G,z,M,L,$,H;v>=128;){for(var ie=0;ie<16;ie++){var q=8*ie+N;h[ie]=e.readUint32BE(E,q),f[ie]=e.readUint32BE(E,q+4)}for(var ie=0;ie<80;ie++){var Z=D,k=U,oe=I,A=R,O=o,S=d,a=u,w=l,B=y,K=n,le=g,be=P,de=j,we=W,Ue=Y,Ne=X;if(C=l,T=X,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=(o>>>14|j<<32-14)^(o>>>18|j<<32-18)^(j>>>41-32|o<<32-(41-32)),T=(j>>>14|o<<32-14)^(j>>>18|o<<32-18)^(o>>>41-32|j<<32-(41-32)),M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,C=o&d^~o&u,T=j&W^~j&Y,M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,C=s[ie*2],T=s[ie*2+1],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,C=h[ie%16],T=f[ie%16],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,G=$&65535|H<<16,z=M&65535|L<<16,C=G,T=z,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=(D>>>28|y<<32-28)^(y>>>34-32|D<<32-(34-32))^(y>>>39-32|D<<32-(39-32)),T=(y>>>28|D<<32-28)^(D>>>34-32|y<<32-(34-32))^(D>>>39-32|y<<32-(39-32)),M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,C=D&U^D&I^U&I,T=y&n^y&g^n&g,M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,w=$&65535|H<<16,Ne=M&65535|L<<16,C=A,T=be,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=G,T=z,M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,A=$&65535|H<<16,be=M&65535|L<<16,U=Z,I=k,R=oe,o=A,d=O,u=S,l=a,D=w,n=B,g=K,P=le,j=be,W=de,Y=we,X=Ue,y=Ne,ie%16===15)for(var q=0;q<16;q++)C=h[q],T=f[q],M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=h[(q+9)%16],T=f[(q+9)%16],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,G=h[(q+1)%16],z=f[(q+1)%16],C=(G>>>1|z<<32-1)^(G>>>8|z<<32-8)^G>>>7,T=(z>>>1|G<<32-1)^(z>>>8|G<<32-8)^(z>>>7|G<<32-7),M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,G=h[(q+14)%16],z=f[(q+14)%16],C=(G>>>19|z<<32-19)^(z>>>61-32|G<<32-(61-32))^G>>>6,T=(z>>>19|G<<32-19)^(G>>>61-32|z<<32-(61-32))^(z>>>6|G<<32-6),M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,h[q]=$&65535|H<<16,f[q]=M&65535|L<<16}C=D,T=y,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[0],T=m[0],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[0]=D=$&65535|H<<16,m[0]=y=M&65535|L<<16,C=U,T=n,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[1],T=m[1],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[1]=U=$&65535|H<<16,m[1]=n=M&65535|L<<16,C=I,T=g,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[2],T=m[2],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[2]=I=$&65535|H<<16,m[2]=g=M&65535|L<<16,C=R,T=P,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[3],T=m[3],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[3]=R=$&65535|H<<16,m[3]=P=M&65535|L<<16,C=o,T=j,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[4],T=m[4],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[4]=o=$&65535|H<<16,m[4]=j=M&65535|L<<16,C=d,T=W,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[5],T=m[5],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[5]=d=$&65535|H<<16,m[5]=W=M&65535|L<<16,C=u,T=Y,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[6],T=m[6],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[6]=u=$&65535|H<<16,m[6]=Y=M&65535|L<<16,C=l,T=X,M=T&65535,L=T>>>16,$=C&65535,H=C>>>16,C=_[7],T=m[7],M+=T&65535,L+=T>>>16,$+=C&65535,H+=C>>>16,L+=M>>>16,$+=L>>>16,H+=$>>>16,_[7]=l=$&65535|H<<16,m[7]=X=M&65535|L<<16,N+=128,v-=128}return N}function p(h){var f=new i;f.update(h);var _=f.digest();return f.clean(),_}t.hash=p})(pa);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=er,r=pa,i=ot;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(A){const O=new Float64Array(16);if(A)for(let S=0;S<A.length;S++)O[S]=A[S];return O}const c=new Uint8Array(32);c[0]=9;const p=s(),h=s([1]),f=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),_=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),m=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),E=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(A,O){for(let S=0;S<16;S++)A[S]=O[S]|0}function D(A){let O=1;for(let S=0;S<16;S++){let a=A[S]+O+65535;O=Math.floor(a/65536),A[S]=a-O*65536}A[0]+=O-1+37*(O-1)}function U(A,O,S){const a=~(S-1);for(let w=0;w<16;w++){const B=a&(A[w]^O[w]);A[w]^=B,O[w]^=B}}function I(A,O){const S=s(),a=s();for(let w=0;w<16;w++)a[w]=O[w];D(a),D(a),D(a);for(let w=0;w<2;w++){S[0]=a[0]-65517;for(let K=1;K<15;K++)S[K]=a[K]-65535-(S[K-1]>>16&1),S[K-1]&=65535;S[15]=a[15]-32767-(S[14]>>16&1);const B=S[15]>>16&1;S[14]&=65535,U(a,S,1-B)}for(let w=0;w<16;w++)A[2*w]=a[w]&255,A[2*w+1]=a[w]>>8}function R(A,O){let S=0;for(let a=0;a<32;a++)S|=A[a]^O[a];return(1&S-1>>>8)-1}function o(A,O){const S=new Uint8Array(32),a=new Uint8Array(32);return I(S,A),I(a,O),R(S,a)}function d(A){const O=new Uint8Array(32);return I(O,A),O[0]&1}function u(A,O){for(let S=0;S<16;S++)A[S]=O[2*S]+(O[2*S+1]<<8);A[15]&=32767}function l(A,O,S){for(let a=0;a<16;a++)A[a]=O[a]+S[a]}function y(A,O,S){for(let a=0;a<16;a++)A[a]=O[a]-S[a]}function n(A,O,S){let a,w,B=0,K=0,le=0,be=0,de=0,we=0,Ue=0,Ne=0,ye=0,pe=0,fe=0,he=0,ce=0,ae=0,ne=0,ee=0,ue=0,ge=0,te=0,me=0,_e=0,ve=0,De=0,Ee=0,ft=0,mt=0,At=0,st=0,Lt=0,rr=0,Ar=0,Re=S[0],Te=S[1],Fe=S[2],Me=S[3],Le=S[4],Ce=S[5],ze=S[6],He=S[7],qe=S[8],Be=S[9],Ke=S[10],je=S[11],$e=S[12],Oe=S[13],Ve=S[14],Ge=S[15];a=O[0],B+=a*Re,K+=a*Te,le+=a*Fe,be+=a*Me,de+=a*Le,we+=a*Ce,Ue+=a*ze,Ne+=a*He,ye+=a*qe,pe+=a*Be,fe+=a*Ke,he+=a*je,ce+=a*$e,ae+=a*Oe,ne+=a*Ve,ee+=a*Ge,a=O[1],K+=a*Re,le+=a*Te,be+=a*Fe,de+=a*Me,we+=a*Le,Ue+=a*Ce,Ne+=a*ze,ye+=a*He,pe+=a*qe,fe+=a*Be,he+=a*Ke,ce+=a*je,ae+=a*$e,ne+=a*Oe,ee+=a*Ve,ue+=a*Ge,a=O[2],le+=a*Re,be+=a*Te,de+=a*Fe,we+=a*Me,Ue+=a*Le,Ne+=a*Ce,ye+=a*ze,pe+=a*He,fe+=a*qe,he+=a*Be,ce+=a*Ke,ae+=a*je,ne+=a*$e,ee+=a*Oe,ue+=a*Ve,ge+=a*Ge,a=O[3],be+=a*Re,de+=a*Te,we+=a*Fe,Ue+=a*Me,Ne+=a*Le,ye+=a*Ce,pe+=a*ze,fe+=a*He,he+=a*qe,ce+=a*Be,ae+=a*Ke,ne+=a*je,ee+=a*$e,ue+=a*Oe,ge+=a*Ve,te+=a*Ge,a=O[4],de+=a*Re,we+=a*Te,Ue+=a*Fe,Ne+=a*Me,ye+=a*Le,pe+=a*Ce,fe+=a*ze,he+=a*He,ce+=a*qe,ae+=a*Be,ne+=a*Ke,ee+=a*je,ue+=a*$e,ge+=a*Oe,te+=a*Ve,me+=a*Ge,a=O[5],we+=a*Re,Ue+=a*Te,Ne+=a*Fe,ye+=a*Me,pe+=a*Le,fe+=a*Ce,he+=a*ze,ce+=a*He,ae+=a*qe,ne+=a*Be,ee+=a*Ke,ue+=a*je,ge+=a*$e,te+=a*Oe,me+=a*Ve,_e+=a*Ge,a=O[6],Ue+=a*Re,Ne+=a*Te,ye+=a*Fe,pe+=a*Me,fe+=a*Le,he+=a*Ce,ce+=a*ze,ae+=a*He,ne+=a*qe,ee+=a*Be,ue+=a*Ke,ge+=a*je,te+=a*$e,me+=a*Oe,_e+=a*Ve,ve+=a*Ge,a=O[7],Ne+=a*Re,ye+=a*Te,pe+=a*Fe,fe+=a*Me,he+=a*Le,ce+=a*Ce,ae+=a*ze,ne+=a*He,ee+=a*qe,ue+=a*Be,ge+=a*Ke,te+=a*je,me+=a*$e,_e+=a*Oe,ve+=a*Ve,De+=a*Ge,a=O[8],ye+=a*Re,pe+=a*Te,fe+=a*Fe,he+=a*Me,ce+=a*Le,ae+=a*Ce,ne+=a*ze,ee+=a*He,ue+=a*qe,ge+=a*Be,te+=a*Ke,me+=a*je,_e+=a*$e,ve+=a*Oe,De+=a*Ve,Ee+=a*Ge,a=O[9],pe+=a*Re,fe+=a*Te,he+=a*Fe,ce+=a*Me,ae+=a*Le,ne+=a*Ce,ee+=a*ze,ue+=a*He,ge+=a*qe,te+=a*Be,me+=a*Ke,_e+=a*je,ve+=a*$e,De+=a*Oe,Ee+=a*Ve,ft+=a*Ge,a=O[10],fe+=a*Re,he+=a*Te,ce+=a*Fe,ae+=a*Me,ne+=a*Le,ee+=a*Ce,ue+=a*ze,ge+=a*He,te+=a*qe,me+=a*Be,_e+=a*Ke,ve+=a*je,De+=a*$e,Ee+=a*Oe,ft+=a*Ve,mt+=a*Ge,a=O[11],he+=a*Re,ce+=a*Te,ae+=a*Fe,ne+=a*Me,ee+=a*Le,ue+=a*Ce,ge+=a*ze,te+=a*He,me+=a*qe,_e+=a*Be,ve+=a*Ke,De+=a*je,Ee+=a*$e,ft+=a*Oe,mt+=a*Ve,At+=a*Ge,a=O[12],ce+=a*Re,ae+=a*Te,ne+=a*Fe,ee+=a*Me,ue+=a*Le,ge+=a*Ce,te+=a*ze,me+=a*He,_e+=a*qe,ve+=a*Be,De+=a*Ke,Ee+=a*je,ft+=a*$e,mt+=a*Oe,At+=a*Ve,st+=a*Ge,a=O[13],ae+=a*Re,ne+=a*Te,ee+=a*Fe,ue+=a*Me,ge+=a*Le,te+=a*Ce,me+=a*ze,_e+=a*He,ve+=a*qe,De+=a*Be,Ee+=a*Ke,ft+=a*je,mt+=a*$e,At+=a*Oe,st+=a*Ve,Lt+=a*Ge,a=O[14],ne+=a*Re,ee+=a*Te,ue+=a*Fe,ge+=a*Me,te+=a*Le,me+=a*Ce,_e+=a*ze,ve+=a*He,De+=a*qe,Ee+=a*Be,ft+=a*Ke,mt+=a*je,At+=a*$e,st+=a*Oe,Lt+=a*Ve,rr+=a*Ge,a=O[15],ee+=a*Re,ue+=a*Te,ge+=a*Fe,te+=a*Me,me+=a*Le,_e+=a*Ce,ve+=a*ze,De+=a*He,Ee+=a*qe,ft+=a*Be,mt+=a*Ke,At+=a*je,st+=a*$e,Lt+=a*Oe,rr+=a*Ve,Ar+=a*Ge,B+=38*ue,K+=38*ge,le+=38*te,be+=38*me,de+=38*_e,we+=38*ve,Ue+=38*De,Ne+=38*Ee,ye+=38*ft,pe+=38*mt,fe+=38*At,he+=38*st,ce+=38*Lt,ae+=38*rr,ne+=38*Ar,w=1,a=B+w+65535,w=Math.floor(a/65536),B=a-w*65536,a=K+w+65535,w=Math.floor(a/65536),K=a-w*65536,a=le+w+65535,w=Math.floor(a/65536),le=a-w*65536,a=be+w+65535,w=Math.floor(a/65536),be=a-w*65536,a=de+w+65535,w=Math.floor(a/65536),de=a-w*65536,a=we+w+65535,w=Math.floor(a/65536),we=a-w*65536,a=Ue+w+65535,w=Math.floor(a/65536),Ue=a-w*65536,a=Ne+w+65535,w=Math.floor(a/65536),Ne=a-w*65536,a=ye+w+65535,w=Math.floor(a/65536),ye=a-w*65536,a=pe+w+65535,w=Math.floor(a/65536),pe=a-w*65536,a=fe+w+65535,w=Math.floor(a/65536),fe=a-w*65536,a=he+w+65535,w=Math.floor(a/65536),he=a-w*65536,a=ce+w+65535,w=Math.floor(a/65536),ce=a-w*65536,a=ae+w+65535,w=Math.floor(a/65536),ae=a-w*65536,a=ne+w+65535,w=Math.floor(a/65536),ne=a-w*65536,a=ee+w+65535,w=Math.floor(a/65536),ee=a-w*65536,B+=w-1+37*(w-1),w=1,a=B+w+65535,w=Math.floor(a/65536),B=a-w*65536,a=K+w+65535,w=Math.floor(a/65536),K=a-w*65536,a=le+w+65535,w=Math.floor(a/65536),le=a-w*65536,a=be+w+65535,w=Math.floor(a/65536),be=a-w*65536,a=de+w+65535,w=Math.floor(a/65536),de=a-w*65536,a=we+w+65535,w=Math.floor(a/65536),we=a-w*65536,a=Ue+w+65535,w=Math.floor(a/65536),Ue=a-w*65536,a=Ne+w+65535,w=Math.floor(a/65536),Ne=a-w*65536,a=ye+w+65535,w=Math.floor(a/65536),ye=a-w*65536,a=pe+w+65535,w=Math.floor(a/65536),pe=a-w*65536,a=fe+w+65535,w=Math.floor(a/65536),fe=a-w*65536,a=he+w+65535,w=Math.floor(a/65536),he=a-w*65536,a=ce+w+65535,w=Math.floor(a/65536),ce=a-w*65536,a=ae+w+65535,w=Math.floor(a/65536),ae=a-w*65536,a=ne+w+65535,w=Math.floor(a/65536),ne=a-w*65536,a=ee+w+65535,w=Math.floor(a/65536),ee=a-w*65536,B+=w-1+37*(w-1),A[0]=B,A[1]=K,A[2]=le,A[3]=be,A[4]=de,A[5]=we,A[6]=Ue,A[7]=Ne,A[8]=ye,A[9]=pe,A[10]=fe,A[11]=he,A[12]=ce,A[13]=ae,A[14]=ne,A[15]=ee}function g(A,O){n(A,O,O)}function P(A,O){const S=s();let a;for(a=0;a<16;a++)S[a]=O[a];for(a=253;a>=0;a--)g(S,S),a!==2&&a!==4&&n(S,S,O);for(a=0;a<16;a++)A[a]=S[a]}function j(A,O){const S=s();let a;for(a=0;a<16;a++)S[a]=O[a];for(a=250;a>=0;a--)g(S,S),a!==1&&n(S,S,O);for(a=0;a<16;a++)A[a]=S[a]}function W(A,O){const S=s(),a=s(),w=s(),B=s(),K=s(),le=s(),be=s(),de=s(),we=s();y(S,A[1],A[0]),y(we,O[1],O[0]),n(S,S,we),l(a,A[0],A[1]),l(we,O[0],O[1]),n(a,a,we),n(w,A[3],O[3]),n(w,w,_),n(B,A[2],O[2]),l(B,B,B),y(K,a,S),y(le,B,w),l(be,B,w),l(de,a,S),n(A[0],K,le),n(A[1],de,be),n(A[2],be,le),n(A[3],K,de)}function Y(A,O,S){for(let a=0;a<4;a++)U(A[a],O[a],S)}function X(A,O){const S=s(),a=s(),w=s();P(w,O[2]),n(S,O[0],w),n(a,O[1],w),I(A,a),A[31]^=d(S)<<7}function C(A,O,S){v(A[0],p),v(A[1],h),v(A[2],h),v(A[3],p);for(let a=255;a>=0;--a){const w=S[a/8|0]>>(a&7)&1;Y(A,O,w),W(O,A),W(A,A),Y(A,O,w)}}function T(A,O){const S=[s(),s(),s(),s()];v(S[0],m),v(S[1],E),v(S[2],h),n(S[3],m,E),C(A,S,O)}function G(A){if(A.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const O=(0,r.hash)(A);O[0]&=248,O[31]&=127,O[31]|=64;const S=new Uint8Array(32),a=[s(),s(),s(),s()];T(a,O),X(S,a);const w=new Uint8Array(64);return w.set(A),w.set(S,32),{publicKey:S,secretKey:w}}t.generateKeyPairFromSeed=G;function z(A){const O=(0,e.randomBytes)(32,A),S=G(O);return(0,i.wipe)(O),S}t.generateKeyPair=z;function M(A){if(A.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(A.subarray(32))}t.extractPublicKeyFromSecretKey=M;const L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function $(A,O){let S,a,w,B;for(a=63;a>=32;--a){for(S=0,w=a-32,B=a-12;w<B;++w)O[w]+=S-16*O[a]*L[w-(a-32)],S=Math.floor((O[w]+128)/256),O[w]-=S*256;O[w]+=S,O[a]=0}for(S=0,w=0;w<32;w++)O[w]+=S-(O[31]>>4)*L[w],S=O[w]>>8,O[w]&=255;for(w=0;w<32;w++)O[w]-=S*L[w];for(a=0;a<32;a++)O[a+1]+=O[a]>>8,A[a]=O[a]&255}function H(A){const O=new Float64Array(64);for(let S=0;S<64;S++)O[S]=A[S];for(let S=0;S<64;S++)A[S]=0;$(A,O)}function ie(A,O){const S=new Float64Array(64),a=[s(),s(),s(),s()],w=(0,r.hash)(A.subarray(0,32));w[0]&=248,w[31]&=127,w[31]|=64;const B=new Uint8Array(64);B.set(w.subarray(32),32);const K=new r.SHA512;K.update(B.subarray(32)),K.update(O);const le=K.digest();K.clean(),H(le),T(a,le),X(B,a),K.reset(),K.update(B.subarray(0,32)),K.update(A.subarray(32)),K.update(O);const be=K.digest();H(be);for(let de=0;de<32;de++)S[de]=le[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)S[de+we]+=be[de]*w[we];return $(B.subarray(32),S),B}t.sign=ie;function q(A,O){const S=s(),a=s(),w=s(),B=s(),K=s(),le=s(),be=s();return v(A[2],h),u(A[1],O),g(w,A[1]),n(B,w,f),y(w,w,A[2]),l(B,A[2],B),g(K,B),g(le,K),n(be,le,K),n(S,be,w),n(S,S,B),j(S,S),n(S,S,w),n(S,S,B),n(S,S,B),n(A[0],S,B),g(a,A[0]),n(a,a,B),o(a,w)&&n(A[0],A[0],N),g(a,A[0]),n(a,a,B),o(a,w)?-1:(d(A[0])===O[31]>>7&&y(A[0],p,A[0]),n(A[3],A[0],A[1]),0)}function Z(A,O,S){const a=new Uint8Array(32),w=[s(),s(),s(),s()],B=[s(),s(),s(),s()];if(S.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(q(B,A))return!1;const K=new r.SHA512;K.update(S.subarray(0,32)),K.update(A),K.update(O);const le=K.digest();return H(le),C(w,B,le),T(B,S.subarray(32)),W(w,B),X(a,w),!R(S,a)}t.verify=Z;function k(A){let O=[s(),s(),s(),s()];if(q(O,A))throw new Error("Ed25519: invalid public key");let S=s(),a=s(),w=O[1];l(S,h,w),y(a,h,w),P(a,a),n(S,S,a);let B=new Uint8Array(32);return I(B,S),B}t.convertPublicKeyToX25519=k;function oe(A){const O=(0,r.hash)(A.subarray(0,32));O[0]&=248,O[31]&=127,O[31]|=64;const S=new Uint8Array(O.subarray(0,32));return(0,i.wipe)(O),S}t.convertSecretKeyToX25519=oe})(Yi);const Sh="EdDSA",xh="JWT",ga=".",ya="base64url",Ih="utf8",Oh="utf8",Ah=":",Nh="did",Th="key",Js="base58btc",Ch="z",Ph="K36",Uh=32;function Ji(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ba(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ji(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Rh(t,e){e||(e=t.reduce((s,c)=>s+c.length,0));const r=ba(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return Ji(r)}function Fh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=s}var h=t.length,f=t.charAt(0),_=Math.log(h)/Math.log(256),m=Math.log(256)/Math.log(h);function E(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var U=0,I=0,R=0,o=D.length;R!==o&&D[R]===0;)R++,U++;for(var d=(o-R)*m+1>>>0,u=new Uint8Array(d);R!==o;){for(var l=D[R],y=0,n=d-1;(l!==0||y<I)&&n!==-1;n--,y++)l+=256*u[n]>>>0,u[n]=l%h>>>0,l=l/h>>>0;if(l!==0)throw new Error("Non-zero carry");I=y,R++}for(var g=d-I;g!==d&&u[g]===0;)g++;for(var P=f.repeat(U);g<d;++g)P+=t.charAt(u[g]);return P}function N(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var U=0;if(D[U]!==" "){for(var I=0,R=0;D[U]===f;)I++,U++;for(var o=(D.length-U)*_+1>>>0,d=new Uint8Array(o);D[U];){var u=r[D.charCodeAt(U)];if(u===255)return;for(var l=0,y=o-1;(u!==0||l<R)&&y!==-1;y--,l++)u+=h*d[y]>>>0,d[y]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");R=l,U++}if(D[U]!==" "){for(var n=o-R;n!==o&&d[n]===0;)n++;for(var g=new Uint8Array(I+(o-n)),P=I;n!==o;)g[P++]=d[n++];return g}}}function v(D){var U=N(D);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:N,decode:v}}var Mh=Fh,Lh=Mh;const ma=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},$h=t=>new TextEncoder().encode(t),jh=t=>new TextDecoder().decode(t);class zh{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Hh{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _a(this,e)}}class qh{constructor(e){this.decoders=e}or(e){return _a(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const _a=(t,e)=>new qh({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Bh{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new zh(e,r,i),this.decoder=new Hh(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zr=({name:t,prefix:e,encode:r,decode:i})=>new Bh(t,e,r,i),Dr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Lh(r,e);return Zr({prefix:t,name:e,encode:i,decode:c=>ma(s(c))})},Kh=(t,e,r,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let h=0,f=0,_=0;for(let m=0;m<c;++m){const E=s[t[m]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);f=f<<r|E,h+=r,h>=8&&(h-=8,p[_++]=255&f>>h)}if(h>=r||255&f<<8-h)throw new SyntaxError("Unexpected end of data");return p},Vh=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",p=0,h=0;for(let f=0;f<t.length;++f)for(h=h<<8|t[f],p+=8;p>r;)p-=r,c+=e[s&h>>p];if(p&&(c+=e[s&h<<r-p]),i)for(;c.length*r&7;)c+="=";return c},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Zr({prefix:e,name:t,encode(s){return Vh(s,i,r)},decode(s){return Kh(s,i,r,t)}}),Gh=Zr({prefix:"\0",name:"identity",encode:t=>jh(t),decode:t=>$h(t)}),kh=Object.freeze(Object.defineProperty({__proto__:null,identity:Gh},Symbol.toStringTag,{value:"Module"})),Wh=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Yh=Object.freeze(Object.defineProperty({__proto__:null,base2:Wh},Symbol.toStringTag,{value:"Module"})),Jh=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Xh=Object.freeze(Object.defineProperty({__proto__:null,base8:Jh},Symbol.toStringTag,{value:"Module"})),Zh=Dr({prefix:"9",name:"base10",alphabet:"0123456789"}),Qh=Object.freeze(Object.defineProperty({__proto__:null,base10:Zh},Symbol.toStringTag,{value:"Module"})),eu=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),tu=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),ru=Object.freeze(Object.defineProperty({__proto__:null,base16:eu,base16upper:tu},Symbol.toStringTag,{value:"Module"})),iu=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),su=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),nu=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),au=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ou=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),cu=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),hu=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),uu=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lu=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),fu=Object.freeze(Object.defineProperty({__proto__:null,base32:iu,base32upper:su,base32pad:nu,base32padupper:au,base32hex:ou,base32hexupper:cu,base32hexpad:hu,base32hexpadupper:uu,base32z:lu},Symbol.toStringTag,{value:"Module"})),du=Dr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),pu=Dr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),gu=Object.freeze(Object.defineProperty({__proto__:null,base36:du,base36upper:pu},Symbol.toStringTag,{value:"Module"})),yu=Dr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),bu=Dr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mu=Object.freeze(Object.defineProperty({__proto__:null,base58btc:yu,base58flickr:bu},Symbol.toStringTag,{value:"Module"})),_u=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),wu=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Eu=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),vu=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Du=Object.freeze(Object.defineProperty({__proto__:null,base64:_u,base64pad:wu,base64url:Eu,base64urlpad:vu},Symbol.toStringTag,{value:"Module"})),wa=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Su=wa.reduce((t,e,r)=>(t[r]=e,t),[]),xu=wa.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Iu(t){return t.reduce((e,r)=>(e+=Su[r],e),"")}function Ou(t){const e=[];for(const r of t){const i=xu[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Au=Zr({prefix:"\u{1F680}",name:"base256emoji",encode:Iu,decode:Ou}),Nu=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Au},Symbol.toStringTag,{value:"Module"}));var Tu=Ea,Xs=128,Cu=127,Pu=~Cu,Uu=Math.pow(2,31);function Ea(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Uu;)e[r++]=t&255|Xs,t/=128;for(;t&Pu;)e[r++]=t&255|Xs,t>>>=7;return e[r]=t|0,Ea.bytes=r-i+1,e}var Ru=Ai,Fu=128,Zs=127;function Ai(t,i){var r=0,i=i||0,s=0,c=i,p,h=t.length;do{if(c>=h)throw Ai.bytes=0,new RangeError("Could not decode varint");p=t[c++],r+=s<28?(p&Zs)<<s:(p&Zs)*Math.pow(2,s),s+=7}while(p>=Fu);return Ai.bytes=c-i,r}var Mu=Math.pow(2,7),Lu=Math.pow(2,14),$u=Math.pow(2,21),ju=Math.pow(2,28),zu=Math.pow(2,35),Hu=Math.pow(2,42),qu=Math.pow(2,49),Bu=Math.pow(2,56),Ku=Math.pow(2,63),Vu=function(t){return t<Mu?1:t<Lu?2:t<$u?3:t<ju?4:t<zu?5:t<Hu?6:t<qu?7:t<Bu?8:t<Ku?9:10},Gu={encode:Tu,decode:Ru,encodingLength:Vu},va=Gu;const Qs=(t,e,r=0)=>(va.encode(t,e,r),e),en=t=>va.encodingLength(t),Ni=(t,e)=>{const r=e.byteLength,i=en(t),s=i+en(r),c=new Uint8Array(s+r);return Qs(t,c,0),Qs(r,c,i),c.set(e,s),new ku(t,r,e,c)};class ku{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Da=({name:t,code:e,encode:r})=>new Wu(t,e,r);class Wu{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ni(this.code,r):r.then(i=>Ni(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Sa=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Yu=Da({name:"sha2-256",code:18,encode:Sa("SHA-256")}),Ju=Da({name:"sha2-512",code:19,encode:Sa("SHA-512")}),Xu=Object.freeze(Object.defineProperty({__proto__:null,sha256:Yu,sha512:Ju},Symbol.toStringTag,{value:"Module"})),xa=0,Zu="identity",Ia=ma,Qu=t=>Ni(xa,Ia(t)),el={code:xa,name:Zu,encode:Ia,digest:Qu},tl=Object.freeze(Object.defineProperty({__proto__:null,identity:el},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const qr={...kh,...Yh,...Xh,...Qh,...ru,...fu,...gu,...mu,...Du,...Nu};({...Xu,...tl});function Oa(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const tn=Oa("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),di=Oa("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ba(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Aa={utf8:tn,"utf-8":tn,hex:qr.base16,latin1:di,ascii:di,binary:di,...qr};function Xi(t,e="utf8"){const r=Aa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Zi(t,e="utf8"){const r=Aa[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ji(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Br(t){return Xi(Zi(zi(t),Ih),ya)}function Na(t){const e=Zi(Ph,Js),r=Ch+Xi(Rh([e,t]),Js);return[Nh,Th,r].join(Ah)}function rl(t){return Xi(t,ya)}function il(t){return Zi([Br(t.header),Br(t.payload)].join(ga),Oh)}function sl(t){return[Br(t.header),Br(t.payload),rl(t.signature)].join(ga)}function rn(t=er.randomBytes(Uh)){return Yi.generateKeyPairFromSeed(t)}async function nl(t,e,r,i,s=J.fromMiliseconds(Date.now())){const c={alg:Sh,typ:xh},p=Na(i.publicKey),h=s+r,f={iss:p,sub:t,aud:e,iat:s,exp:h},_=il({header:c,payload:f}),m=Yi.sign(i.secretKey,_);return sl({header:c,payload:f,signature:m})}var Qi={},Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});var Qe=re,Ti=ot,al=20;function ol(t,e,r){for(var i=1634760805,s=857760878,c=2036477234,p=1797285236,h=r[3]<<24|r[2]<<16|r[1]<<8|r[0],f=r[7]<<24|r[6]<<16|r[5]<<8|r[4],_=r[11]<<24|r[10]<<16|r[9]<<8|r[8],m=r[15]<<24|r[14]<<16|r[13]<<8|r[12],E=r[19]<<24|r[18]<<16|r[17]<<8|r[16],N=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],D=r[31]<<24|r[30]<<16|r[29]<<8|r[28],U=e[3]<<24|e[2]<<16|e[1]<<8|e[0],I=e[7]<<24|e[6]<<16|e[5]<<8|e[4],R=e[11]<<24|e[10]<<16|e[9]<<8|e[8],o=e[15]<<24|e[14]<<16|e[13]<<8|e[12],d=i,u=s,l=c,y=p,n=h,g=f,P=_,j=m,W=E,Y=N,X=v,C=D,T=U,G=I,z=R,M=o,L=0;L<al;L+=2)d=d+n|0,T^=d,T=T>>>32-16|T<<16,W=W+T|0,n^=W,n=n>>>32-12|n<<12,u=u+g|0,G^=u,G=G>>>32-16|G<<16,Y=Y+G|0,g^=Y,g=g>>>32-12|g<<12,l=l+P|0,z^=l,z=z>>>32-16|z<<16,X=X+z|0,P^=X,P=P>>>32-12|P<<12,y=y+j|0,M^=y,M=M>>>32-16|M<<16,C=C+M|0,j^=C,j=j>>>32-12|j<<12,l=l+P|0,z^=l,z=z>>>32-8|z<<8,X=X+z|0,P^=X,P=P>>>32-7|P<<7,y=y+j|0,M^=y,M=M>>>32-8|M<<8,C=C+M|0,j^=C,j=j>>>32-7|j<<7,u=u+g|0,G^=u,G=G>>>32-8|G<<8,Y=Y+G|0,g^=Y,g=g>>>32-7|g<<7,d=d+n|0,T^=d,T=T>>>32-8|T<<8,W=W+T|0,n^=W,n=n>>>32-7|n<<7,d=d+g|0,M^=d,M=M>>>32-16|M<<16,X=X+M|0,g^=X,g=g>>>32-12|g<<12,u=u+P|0,T^=u,T=T>>>32-16|T<<16,C=C+T|0,P^=C,P=P>>>32-12|P<<12,l=l+j|0,G^=l,G=G>>>32-16|G<<16,W=W+G|0,j^=W,j=j>>>32-12|j<<12,y=y+n|0,z^=y,z=z>>>32-16|z<<16,Y=Y+z|0,n^=Y,n=n>>>32-12|n<<12,l=l+j|0,G^=l,G=G>>>32-8|G<<8,W=W+G|0,j^=W,j=j>>>32-7|j<<7,y=y+n|0,z^=y,z=z>>>32-8|z<<8,Y=Y+z|0,n^=Y,n=n>>>32-7|n<<7,u=u+P|0,T^=u,T=T>>>32-8|T<<8,C=C+T|0,P^=C,P=P>>>32-7|P<<7,d=d+g|0,M^=d,M=M>>>32-8|M<<8,X=X+M|0,g^=X,g=g>>>32-7|g<<7;Qe.writeUint32LE(d+i|0,t,0),Qe.writeUint32LE(u+s|0,t,4),Qe.writeUint32LE(l+c|0,t,8),Qe.writeUint32LE(y+p|0,t,12),Qe.writeUint32LE(n+h|0,t,16),Qe.writeUint32LE(g+f|0,t,20),Qe.writeUint32LE(P+_|0,t,24),Qe.writeUint32LE(j+m|0,t,28),Qe.writeUint32LE(W+E|0,t,32),Qe.writeUint32LE(Y+N|0,t,36),Qe.writeUint32LE(X+v|0,t,40),Qe.writeUint32LE(C+D|0,t,44),Qe.writeUint32LE(T+U|0,t,48),Qe.writeUint32LE(G+I|0,t,52),Qe.writeUint32LE(z+R|0,t,56),Qe.writeUint32LE(M+o|0,t,60)}function Ta(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var c,p;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),p=c.length-e.length,c.set(e,p)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,p=s}for(var h=new Uint8Array(64),f=0;f<r.length;f+=64){ol(h,c,t);for(var _=f;_<f+64&&_<r.length;_++)i[_]=r[_]^h[_-f];hl(c,0,p)}return Ti.wipe(h),s===0&&Ti.wipe(c),i}Qr.streamXOR=Ta;function cl(t,e,r,i){return i===void 0&&(i=0),Ti.wipe(r),Ta(t,e,r,r,i)}Qr.stream=cl;function hl(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var Ca={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});function ul(t,e,r){return~(t-1)&e|t-1&r}Mt.select=ul;function ll(t,e){return(t|0)-(e|0)-1>>>31&1}Mt.lessOrEqual=ll;function Pa(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Mt.compare=Pa;function fl(t,e){return t.length===0||e.length===0?!1:Pa(t,e)!==0}Mt.equal=fl;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Mt,r=ot;t.DIGEST_LENGTH=16;var i=function(){function p(h){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var f=h[0]|h[1]<<8;this._r[0]=f&8191;var _=h[2]|h[3]<<8;this._r[1]=(f>>>13|_<<3)&8191;var m=h[4]|h[5]<<8;this._r[2]=(_>>>10|m<<6)&7939;var E=h[6]|h[7]<<8;this._r[3]=(m>>>7|E<<9)&8191;var N=h[8]|h[9]<<8;this._r[4]=(E>>>4|N<<12)&255,this._r[5]=N>>>1&8190;var v=h[10]|h[11]<<8;this._r[6]=(N>>>14|v<<2)&8191;var D=h[12]|h[13]<<8;this._r[7]=(v>>>11|D<<5)&8065;var U=h[14]|h[15]<<8;this._r[8]=(D>>>8|U<<8)&8191,this._r[9]=U>>>5&127,this._pad[0]=h[16]|h[17]<<8,this._pad[1]=h[18]|h[19]<<8,this._pad[2]=h[20]|h[21]<<8,this._pad[3]=h[22]|h[23]<<8,this._pad[4]=h[24]|h[25]<<8,this._pad[5]=h[26]|h[27]<<8,this._pad[6]=h[28]|h[29]<<8,this._pad[7]=h[30]|h[31]<<8}return p.prototype._blocks=function(h,f,_){for(var m=this._fin?0:2048,E=this._h[0],N=this._h[1],v=this._h[2],D=this._h[3],U=this._h[4],I=this._h[5],R=this._h[6],o=this._h[7],d=this._h[8],u=this._h[9],l=this._r[0],y=this._r[1],n=this._r[2],g=this._r[3],P=this._r[4],j=this._r[5],W=this._r[6],Y=this._r[7],X=this._r[8],C=this._r[9];_>=16;){var T=h[f+0]|h[f+1]<<8;E+=T&8191;var G=h[f+2]|h[f+3]<<8;N+=(T>>>13|G<<3)&8191;var z=h[f+4]|h[f+5]<<8;v+=(G>>>10|z<<6)&8191;var M=h[f+6]|h[f+7]<<8;D+=(z>>>7|M<<9)&8191;var L=h[f+8]|h[f+9]<<8;U+=(M>>>4|L<<12)&8191,I+=L>>>1&8191;var $=h[f+10]|h[f+11]<<8;R+=(L>>>14|$<<2)&8191;var H=h[f+12]|h[f+13]<<8;o+=($>>>11|H<<5)&8191;var ie=h[f+14]|h[f+15]<<8;d+=(H>>>8|ie<<8)&8191,u+=ie>>>5|m;var q=0,Z=q;Z+=E*l,Z+=N*(5*C),Z+=v*(5*X),Z+=D*(5*Y),Z+=U*(5*W),q=Z>>>13,Z&=8191,Z+=I*(5*j),Z+=R*(5*P),Z+=o*(5*g),Z+=d*(5*n),Z+=u*(5*y),q+=Z>>>13,Z&=8191;var k=q;k+=E*y,k+=N*l,k+=v*(5*C),k+=D*(5*X),k+=U*(5*Y),q=k>>>13,k&=8191,k+=I*(5*W),k+=R*(5*j),k+=o*(5*P),k+=d*(5*g),k+=u*(5*n),q+=k>>>13,k&=8191;var oe=q;oe+=E*n,oe+=N*y,oe+=v*l,oe+=D*(5*C),oe+=U*(5*X),q=oe>>>13,oe&=8191,oe+=I*(5*Y),oe+=R*(5*W),oe+=o*(5*j),oe+=d*(5*P),oe+=u*(5*g),q+=oe>>>13,oe&=8191;var A=q;A+=E*g,A+=N*n,A+=v*y,A+=D*l,A+=U*(5*C),q=A>>>13,A&=8191,A+=I*(5*X),A+=R*(5*Y),A+=o*(5*W),A+=d*(5*j),A+=u*(5*P),q+=A>>>13,A&=8191;var O=q;O+=E*P,O+=N*g,O+=v*n,O+=D*y,O+=U*l,q=O>>>13,O&=8191,O+=I*(5*C),O+=R*(5*X),O+=o*(5*Y),O+=d*(5*W),O+=u*(5*j),q+=O>>>13,O&=8191;var S=q;S+=E*j,S+=N*P,S+=v*g,S+=D*n,S+=U*y,q=S>>>13,S&=8191,S+=I*l,S+=R*(5*C),S+=o*(5*X),S+=d*(5*Y),S+=u*(5*W),q+=S>>>13,S&=8191;var a=q;a+=E*W,a+=N*j,a+=v*P,a+=D*g,a+=U*n,q=a>>>13,a&=8191,a+=I*y,a+=R*l,a+=o*(5*C),a+=d*(5*X),a+=u*(5*Y),q+=a>>>13,a&=8191;var w=q;w+=E*Y,w+=N*W,w+=v*j,w+=D*P,w+=U*g,q=w>>>13,w&=8191,w+=I*n,w+=R*y,w+=o*l,w+=d*(5*C),w+=u*(5*X),q+=w>>>13,w&=8191;var B=q;B+=E*X,B+=N*Y,B+=v*W,B+=D*j,B+=U*P,q=B>>>13,B&=8191,B+=I*g,B+=R*n,B+=o*y,B+=d*l,B+=u*(5*C),q+=B>>>13,B&=8191;var K=q;K+=E*C,K+=N*X,K+=v*Y,K+=D*W,K+=U*j,q=K>>>13,K&=8191,K+=I*P,K+=R*g,K+=o*n,K+=d*y,K+=u*l,q+=K>>>13,K&=8191,q=(q<<2)+q|0,q=q+Z|0,Z=q&8191,q=q>>>13,k+=q,E=Z,N=k,v=oe,D=A,U=O,I=S,R=a,o=w,d=B,u=K,f+=16,_-=16}this._h[0]=E,this._h[1]=N,this._h[2]=v,this._h[3]=D,this._h[4]=U,this._h[5]=I,this._h[6]=R,this._h[7]=o,this._h[8]=d,this._h[9]=u},p.prototype.finish=function(h,f){f===void 0&&(f=0);var _=new Uint16Array(10),m,E,N,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(m=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=m,m=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=m*5,m=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=m,m=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=m,_[0]=this._h[0]+5,m=_[0]>>>13,_[0]&=8191,v=1;v<10;v++)_[v]=this._h[v]+m,m=_[v]>>>13,_[v]&=8191;for(_[9]-=1<<13,E=(m^1)-1,v=0;v<10;v++)_[v]&=E;for(E=~E,v=0;v<10;v++)this._h[v]=this._h[v]&E|_[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,N=this._h[0]+this._pad[0],this._h[0]=N&65535,v=1;v<8;v++)N=(this._h[v]+this._pad[v]|0)+(N>>>16)|0,this._h[v]=N&65535;return h[f+0]=this._h[0]>>>0,h[f+1]=this._h[0]>>>8,h[f+2]=this._h[1]>>>0,h[f+3]=this._h[1]>>>8,h[f+4]=this._h[2]>>>0,h[f+5]=this._h[2]>>>8,h[f+6]=this._h[3]>>>0,h[f+7]=this._h[3]>>>8,h[f+8]=this._h[4]>>>0,h[f+9]=this._h[4]>>>8,h[f+10]=this._h[5]>>>0,h[f+11]=this._h[5]>>>8,h[f+12]=this._h[6]>>>0,h[f+13]=this._h[6]>>>8,h[f+14]=this._h[7]>>>0,h[f+15]=this._h[7]>>>8,this._finished=!0,this},p.prototype.update=function(h){var f=0,_=h.length,m;if(this._leftover){m=16-this._leftover,m>_&&(m=_);for(var E=0;E<m;E++)this._buffer[this._leftover+E]=h[f+E];if(_-=m,f+=m,this._leftover+=m,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(_>=16&&(m=_-_%16,this._blocks(h,f,m),f+=m,_-=m),_){for(var E=0;E<_;E++)this._buffer[this._leftover+E]=h[f+E];this._leftover+=_}return this},p.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var h=new Uint8Array(16);return this.finish(h),h},p.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},p}();t.Poly1305=i;function s(p,h){var f=new i(p);f.update(h);var _=f.digest();return f.clean(),_}t.oneTimeAuth=s;function c(p,h){return p.length!==t.DIGEST_LENGTH||h.length!==t.DIGEST_LENGTH?!1:e.equal(p,h)}t.equal=c})(Ca);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Qr,r=Ca,i=ot,s=re,c=Mt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var p=new Uint8Array(16),h=function(){function f(_){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,_.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(_)}return f.prototype.seal=function(_,m,E,N){if(_.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(_,v.length-_.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var U=m.length+this.tagLength,I;if(N){if(N.length!==U)throw new Error("ChaCha20Poly1305: incorrect destination length");I=N}else I=new Uint8Array(U);return e.streamXOR(this._key,v,m,I,4),this._authenticate(I.subarray(I.length-this.tagLength,I.length),D,I.subarray(0,I.length-this.tagLength),E),i.wipe(v),I},f.prototype.open=function(_,m,E,N){if(_.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(m.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(_,v.length-_.length);var D=new Uint8Array(32);e.stream(this._key,v,D,4);var U=new Uint8Array(this.tagLength);if(this._authenticate(U,D,m.subarray(0,m.length-this.tagLength),E),!c.equal(U,m.subarray(m.length-this.tagLength,m.length)))return null;var I=m.length-this.tagLength,R;if(N){if(N.length!==I)throw new Error("ChaCha20Poly1305: incorrect destination length");R=N}else R=new Uint8Array(I);return e.streamXOR(this._key,v,m.subarray(0,m.length-this.tagLength),R,4),i.wipe(v),R},f.prototype.clean=function(){return i.wipe(this._key),this},f.prototype._authenticate=function(_,m,E,N){var v=new r.Poly1305(m);N&&(v.update(N),N.length%16>0&&v.update(p.subarray(N.length%16))),v.update(E),E.length%16>0&&v.update(p.subarray(E.length%16));var D=new Uint8Array(8);N&&s.writeUint64LE(N.length,D),v.update(D),s.writeUint64LE(E.length,D),v.update(D);for(var U=v.digest(),I=0;I<U.length;I++)_[I]=U[I];v.clean(),i.wipe(U),i.wipe(D)},f}();t.ChaCha20Poly1305=h})(Qi);var Ua={},Sr={},es={};Object.defineProperty(es,"__esModule",{value:!0});function dl(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}es.isSerializableHash=dl;Object.defineProperty(Sr,"__esModule",{value:!0});var _t=es,pl=Mt,gl=ot,Ra=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),_t.isSerializableHash(this._inner)&&_t.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),gl.wipe(i)}return t.prototype.reset=function(){if(!_t.isSerializableHash(this._inner)||!_t.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){_t.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),_t.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!_t.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!_t.isSerializableHash(this._inner)||!_t.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!_t.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Sr.HMAC=Ra;function yl(t,e,r){var i=new Ra(t,e);i.update(r);var s=i.digest();return i.clean(),s}Sr.hmac=yl;Sr.equal=pl.equal;Object.defineProperty(Ua,"__esModule",{value:!0});var sn=Sr,nn=ot,bl=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var c=sn.hmac(this._hash,i,r);this._hmac=new sn.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),nn.wipe(this._buffer),nn.wipe(this._counter),this._bufpos=0},t}(),ml=Ua.HKDF=bl,ei={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ot;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function h(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return h.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},h.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},h.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},h.prototype.update=function(f,_){if(_===void 0&&(_=f.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var m=0;if(this._bytesHashed+=_,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&_>0;)this._buffer[this._bufferLength++]=f[m++],_--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(_>=this.blockSize&&(m=c(this._temp,this._state,f,m,_),_%=this.blockSize);_>0;)this._buffer[this._bufferLength++]=f[m++],_--;return this},h.prototype.finish=function(f){if(!this._finished){var _=this._bytesHashed,m=this._bufferLength,E=_/536870912|0,N=_<<3,v=_%64<56?64:128;this._buffer[m]=128;for(var D=m+1;D<v-8;D++)this._buffer[D]=0;e.writeUint32BE(E,this._buffer,v-8),e.writeUint32BE(N,this._buffer,v-4),c(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var D=0;D<this.digestLength/4;D++)e.writeUint32BE(this._state[D],f,D*4);return this},h.prototype.digest=function(){var f=new Uint8Array(this.digestLength);return this.finish(f),f},h.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},h.prototype.restoreState=function(f){return this._state.set(f.state),this._bufferLength=f.bufferLength,f.buffer&&this._buffer.set(f.buffer),this._bytesHashed=f.bytesHashed,this._finished=!1,this},h.prototype.cleanSavedState=function(f){r.wipe(f.state),f.buffer&&r.wipe(f.buffer),f.bufferLength=0,f.bytesHashed=0},h}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(h,f,_,m,E){for(;E>=64;){for(var N=f[0],v=f[1],D=f[2],U=f[3],I=f[4],R=f[5],o=f[6],d=f[7],u=0;u<16;u++){var l=m+u*4;h[u]=e.readUint32BE(_,l)}for(var u=16;u<64;u++){var y=h[u-2],n=(y>>>17|y<<32-17)^(y>>>19|y<<32-19)^y>>>10;y=h[u-15];var g=(y>>>7|y<<32-7)^(y>>>18|y<<32-18)^y>>>3;h[u]=(n+h[u-7]|0)+(g+h[u-16]|0)}for(var u=0;u<64;u++){var n=(((I>>>6|I<<26)^(I>>>11|I<<21)^(I>>>25|I<<7))+(I&R^~I&o)|0)+(d+(s[u]+h[u]|0)|0)|0,g=((N>>>2|N<<32-2)^(N>>>13|N<<32-13)^(N>>>22|N<<32-22))+(N&v^N&D^v&D)|0;d=o,o=R,R=I,I=U+n|0,U=D,D=v,v=N,N=n+g|0}f[0]+=N,f[1]+=v,f[2]+=D,f[3]+=U,f[4]+=I,f[5]+=R,f[6]+=o,f[7]+=d,m+=64,E-=64}return m}function p(h){var f=new i;f.update(h);var _=f.digest();return f.clean(),_}t.hash=p})(ei);var ts={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=er,r=ot;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(u){const l=new Float64Array(16);if(u)for(let y=0;y<u.length;y++)l[y]=u[y];return l}const s=new Uint8Array(32);s[0]=9;const c=i([56129,1]);function p(u){let l=1;for(let y=0;y<16;y++){let n=u[y]+l+65535;l=Math.floor(n/65536),u[y]=n-l*65536}u[0]+=l-1+37*(l-1)}function h(u,l,y){const n=~(y-1);for(let g=0;g<16;g++){const P=n&(u[g]^l[g]);u[g]^=P,l[g]^=P}}function f(u,l){const y=i(),n=i();for(let g=0;g<16;g++)n[g]=l[g];p(n),p(n),p(n);for(let g=0;g<2;g++){y[0]=n[0]-65517;for(let j=1;j<15;j++)y[j]=n[j]-65535-(y[j-1]>>16&1),y[j-1]&=65535;y[15]=n[15]-32767-(y[14]>>16&1);const P=y[15]>>16&1;y[14]&=65535,h(n,y,1-P)}for(let g=0;g<16;g++)u[2*g]=n[g]&255,u[2*g+1]=n[g]>>8}function _(u,l){for(let y=0;y<16;y++)u[y]=l[2*y]+(l[2*y+1]<<8);u[15]&=32767}function m(u,l,y){for(let n=0;n<16;n++)u[n]=l[n]+y[n]}function E(u,l,y){for(let n=0;n<16;n++)u[n]=l[n]-y[n]}function N(u,l,y){let n,g,P=0,j=0,W=0,Y=0,X=0,C=0,T=0,G=0,z=0,M=0,L=0,$=0,H=0,ie=0,q=0,Z=0,k=0,oe=0,A=0,O=0,S=0,a=0,w=0,B=0,K=0,le=0,be=0,de=0,we=0,Ue=0,Ne=0,ye=y[0],pe=y[1],fe=y[2],he=y[3],ce=y[4],ae=y[5],ne=y[6],ee=y[7],ue=y[8],ge=y[9],te=y[10],me=y[11],_e=y[12],ve=y[13],De=y[14],Ee=y[15];n=l[0],P+=n*ye,j+=n*pe,W+=n*fe,Y+=n*he,X+=n*ce,C+=n*ae,T+=n*ne,G+=n*ee,z+=n*ue,M+=n*ge,L+=n*te,$+=n*me,H+=n*_e,ie+=n*ve,q+=n*De,Z+=n*Ee,n=l[1],j+=n*ye,W+=n*pe,Y+=n*fe,X+=n*he,C+=n*ce,T+=n*ae,G+=n*ne,z+=n*ee,M+=n*ue,L+=n*ge,$+=n*te,H+=n*me,ie+=n*_e,q+=n*ve,Z+=n*De,k+=n*Ee,n=l[2],W+=n*ye,Y+=n*pe,X+=n*fe,C+=n*he,T+=n*ce,G+=n*ae,z+=n*ne,M+=n*ee,L+=n*ue,$+=n*ge,H+=n*te,ie+=n*me,q+=n*_e,Z+=n*ve,k+=n*De,oe+=n*Ee,n=l[3],Y+=n*ye,X+=n*pe,C+=n*fe,T+=n*he,G+=n*ce,z+=n*ae,M+=n*ne,L+=n*ee,$+=n*ue,H+=n*ge,ie+=n*te,q+=n*me,Z+=n*_e,k+=n*ve,oe+=n*De,A+=n*Ee,n=l[4],X+=n*ye,C+=n*pe,T+=n*fe,G+=n*he,z+=n*ce,M+=n*ae,L+=n*ne,$+=n*ee,H+=n*ue,ie+=n*ge,q+=n*te,Z+=n*me,k+=n*_e,oe+=n*ve,A+=n*De,O+=n*Ee,n=l[5],C+=n*ye,T+=n*pe,G+=n*fe,z+=n*he,M+=n*ce,L+=n*ae,$+=n*ne,H+=n*ee,ie+=n*ue,q+=n*ge,Z+=n*te,k+=n*me,oe+=n*_e,A+=n*ve,O+=n*De,S+=n*Ee,n=l[6],T+=n*ye,G+=n*pe,z+=n*fe,M+=n*he,L+=n*ce,$+=n*ae,H+=n*ne,ie+=n*ee,q+=n*ue,Z+=n*ge,k+=n*te,oe+=n*me,A+=n*_e,O+=n*ve,S+=n*De,a+=n*Ee,n=l[7],G+=n*ye,z+=n*pe,M+=n*fe,L+=n*he,$+=n*ce,H+=n*ae,ie+=n*ne,q+=n*ee,Z+=n*ue,k+=n*ge,oe+=n*te,A+=n*me,O+=n*_e,S+=n*ve,a+=n*De,w+=n*Ee,n=l[8],z+=n*ye,M+=n*pe,L+=n*fe,$+=n*he,H+=n*ce,ie+=n*ae,q+=n*ne,Z+=n*ee,k+=n*ue,oe+=n*ge,A+=n*te,O+=n*me,S+=n*_e,a+=n*ve,w+=n*De,B+=n*Ee,n=l[9],M+=n*ye,L+=n*pe,$+=n*fe,H+=n*he,ie+=n*ce,q+=n*ae,Z+=n*ne,k+=n*ee,oe+=n*ue,A+=n*ge,O+=n*te,S+=n*me,a+=n*_e,w+=n*ve,B+=n*De,K+=n*Ee,n=l[10],L+=n*ye,$+=n*pe,H+=n*fe,ie+=n*he,q+=n*ce,Z+=n*ae,k+=n*ne,oe+=n*ee,A+=n*ue,O+=n*ge,S+=n*te,a+=n*me,w+=n*_e,B+=n*ve,K+=n*De,le+=n*Ee,n=l[11],$+=n*ye,H+=n*pe,ie+=n*fe,q+=n*he,Z+=n*ce,k+=n*ae,oe+=n*ne,A+=n*ee,O+=n*ue,S+=n*ge,a+=n*te,w+=n*me,B+=n*_e,K+=n*ve,le+=n*De,be+=n*Ee,n=l[12],H+=n*ye,ie+=n*pe,q+=n*fe,Z+=n*he,k+=n*ce,oe+=n*ae,A+=n*ne,O+=n*ee,S+=n*ue,a+=n*ge,w+=n*te,B+=n*me,K+=n*_e,le+=n*ve,be+=n*De,de+=n*Ee,n=l[13],ie+=n*ye,q+=n*pe,Z+=n*fe,k+=n*he,oe+=n*ce,A+=n*ae,O+=n*ne,S+=n*ee,a+=n*ue,w+=n*ge,B+=n*te,K+=n*me,le+=n*_e,be+=n*ve,de+=n*De,we+=n*Ee,n=l[14],q+=n*ye,Z+=n*pe,k+=n*fe,oe+=n*he,A+=n*ce,O+=n*ae,S+=n*ne,a+=n*ee,w+=n*ue,B+=n*ge,K+=n*te,le+=n*me,be+=n*_e,de+=n*ve,we+=n*De,Ue+=n*Ee,n=l[15],Z+=n*ye,k+=n*pe,oe+=n*fe,A+=n*he,O+=n*ce,S+=n*ae,a+=n*ne,w+=n*ee,B+=n*ue,K+=n*ge,le+=n*te,be+=n*me,de+=n*_e,we+=n*ve,Ue+=n*De,Ne+=n*Ee,P+=38*k,j+=38*oe,W+=38*A,Y+=38*O,X+=38*S,C+=38*a,T+=38*w,G+=38*B,z+=38*K,M+=38*le,L+=38*be,$+=38*de,H+=38*we,ie+=38*Ue,q+=38*Ne,g=1,n=P+g+65535,g=Math.floor(n/65536),P=n-g*65536,n=j+g+65535,g=Math.floor(n/65536),j=n-g*65536,n=W+g+65535,g=Math.floor(n/65536),W=n-g*65536,n=Y+g+65535,g=Math.floor(n/65536),Y=n-g*65536,n=X+g+65535,g=Math.floor(n/65536),X=n-g*65536,n=C+g+65535,g=Math.floor(n/65536),C=n-g*65536,n=T+g+65535,g=Math.floor(n/65536),T=n-g*65536,n=G+g+65535,g=Math.floor(n/65536),G=n-g*65536,n=z+g+65535,g=Math.floor(n/65536),z=n-g*65536,n=M+g+65535,g=Math.floor(n/65536),M=n-g*65536,n=L+g+65535,g=Math.floor(n/65536),L=n-g*65536,n=$+g+65535,g=Math.floor(n/65536),$=n-g*65536,n=H+g+65535,g=Math.floor(n/65536),H=n-g*65536,n=ie+g+65535,g=Math.floor(n/65536),ie=n-g*65536,n=q+g+65535,g=Math.floor(n/65536),q=n-g*65536,n=Z+g+65535,g=Math.floor(n/65536),Z=n-g*65536,P+=g-1+37*(g-1),g=1,n=P+g+65535,g=Math.floor(n/65536),P=n-g*65536,n=j+g+65535,g=Math.floor(n/65536),j=n-g*65536,n=W+g+65535,g=Math.floor(n/65536),W=n-g*65536,n=Y+g+65535,g=Math.floor(n/65536),Y=n-g*65536,n=X+g+65535,g=Math.floor(n/65536),X=n-g*65536,n=C+g+65535,g=Math.floor(n/65536),C=n-g*65536,n=T+g+65535,g=Math.floor(n/65536),T=n-g*65536,n=G+g+65535,g=Math.floor(n/65536),G=n-g*65536,n=z+g+65535,g=Math.floor(n/65536),z=n-g*65536,n=M+g+65535,g=Math.floor(n/65536),M=n-g*65536,n=L+g+65535,g=Math.floor(n/65536),L=n-g*65536,n=$+g+65535,g=Math.floor(n/65536),$=n-g*65536,n=H+g+65535,g=Math.floor(n/65536),H=n-g*65536,n=ie+g+65535,g=Math.floor(n/65536),ie=n-g*65536,n=q+g+65535,g=Math.floor(n/65536),q=n-g*65536,n=Z+g+65535,g=Math.floor(n/65536),Z=n-g*65536,P+=g-1+37*(g-1),u[0]=P,u[1]=j,u[2]=W,u[3]=Y,u[4]=X,u[5]=C,u[6]=T,u[7]=G,u[8]=z,u[9]=M,u[10]=L,u[11]=$,u[12]=H,u[13]=ie,u[14]=q,u[15]=Z}function v(u,l){N(u,l,l)}function D(u,l){const y=i();for(let n=0;n<16;n++)y[n]=l[n];for(let n=253;n>=0;n--)v(y,y),n!==2&&n!==4&&N(y,y,l);for(let n=0;n<16;n++)u[n]=y[n]}function U(u,l){const y=new Uint8Array(32),n=new Float64Array(80),g=i(),P=i(),j=i(),W=i(),Y=i(),X=i();for(let z=0;z<31;z++)y[z]=u[z];y[31]=u[31]&127|64,y[0]&=248,_(n,l);for(let z=0;z<16;z++)P[z]=n[z];g[0]=W[0]=1;for(let z=254;z>=0;--z){const M=y[z>>>3]>>>(z&7)&1;h(g,P,M),h(j,W,M),m(Y,g,j),E(g,g,j),m(j,P,W),E(P,P,W),v(W,Y),v(X,g),N(g,j,g),N(j,P,Y),m(Y,g,j),E(g,g,j),v(P,g),E(j,W,X),N(g,j,c),m(g,g,W),N(j,j,g),N(g,W,X),N(W,P,n),v(P,Y),h(g,P,M),h(j,W,M)}for(let z=0;z<16;z++)n[z+16]=g[z],n[z+32]=j[z],n[z+48]=P[z],n[z+64]=W[z];const C=n.subarray(32),T=n.subarray(16);D(C,C),N(T,T,C);const G=new Uint8Array(32);return f(G,T),G}t.scalarMult=U;function I(u){return U(u,s)}t.scalarMultBase=I;function R(u){if(u.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const l=new Uint8Array(u);return{publicKey:I(l),secretKey:l}}t.generateKeyPairFromSeed=R;function o(u){const l=(0,e.randomBytes)(32,u),y=R(l);return(0,r.wipe)(l),y}t.generateKeyPair=o;function d(u,l,y=!1){if(u.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(l.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=U(u,l);if(y){let g=0;for(let P=0;P<n.length;P++)g|=n[P];if(g===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=d})(ts);function Fa(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function an(t,e){e||(e=t.reduce((s,c)=>s+c.length,0));const r=Fa(e);let i=0;for(const s of t)r.set(s,i),i+=s.length;return r}function Ma(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const on=Ma("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),pi=Ma("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Fa(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),La={utf8:on,"utf-8":on,hex:qr.base16,latin1:pi,ascii:pi,binary:pi,...qr};function gt(t,e="utf8"){const r=La[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}function yt(t,e="utf8"){const r=La[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}var cn=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,s=e.length,c;i<s;i++)(c||!(i in e))&&(c||(c=Array.prototype.slice.call(e,0,i)),c[i]=e[i]);return t.concat(c||Array.prototype.slice.call(e))},_l=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),wl=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),El=function(){function t(e,r,i,s){this.name=e,this.version=r,this.os=i,this.bot=s,this.type="bot-device"}return t}(),vl=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Dl=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Sl=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,xl=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,hn=3,Il=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Sl]],un=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ol(t){return t?ln(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Dl:typeof navigator<"u"?ln(navigator.userAgent):Tl()}function Al(t){return t!==""&&Il.reduce(function(e,r){var i=r[0],s=r[1];if(e)return e;var c=s.exec(t);return!!c&&[i,c]},!1)}function ln(t){var e=Al(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new vl;var s=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);s?s.length<hn&&(s=cn(cn([],s,!0),Cl(hn-s.length),!0)):s=[];var c=s.join("."),p=Nl(t),h=xl.exec(t);return h&&h[1]?new El(r,c,p,h[1]):new _l(r,c,p)}function Nl(t){for(var e=0,r=un.length;e<r;e++){var i=un[e],s=i[0],c=i[1],p=c.exec(t);if(p)return s}return null}function Tl(){var t=typeof process<"u"&&process.version;return t?new wl(process.version.slice(1)):null}function Cl(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var rs={};Object.defineProperty(rs,"__esModule",{value:!0});rs.getWindowMetadata=void 0;const fn=Hi;function Pl(){let t,e;try{t=fn.getDocumentOrThrow(),e=fn.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),N=[];for(let v=0;v<E.length;v++){const D=E[v],U=D.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const I=D.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(I.indexOf("/")===0)R+=I;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");R+=d+"/"+I}N.push(R)}else if(I.indexOf("//")===0){const R=e.protocol+I;N.push(R)}else N.push(I)}}return N}function i(...E){const N=t.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],U=["itemprop","property","name"].map(I=>D.getAttribute(I)).filter(I=>I?E.includes(I):!1);if(U.length&&U){const I=D.getAttribute("content");if(I)return I}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),h=c(),f=e.origin,_=r();return{description:h,url:f,icons:_,name:p}}rs.getWindowMetadata=Pl;var mr={},is=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),c=0;c<i.length;c++){var p=i[c],h=t[p];(s?e.indexOf(p)!==-1:e(p,h,t))&&(r[p]=h)}return r};(function(t){const e=Bi,r=Ki,i=qi,s=is,c=o=>o==null,p=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,l)=>{const y=u.length;return l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[",y,"]"].join("")]:[...u,[m(d,o),"[",m(y,o),"]=",m(l,o)].join("")]};case"bracket":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(l,o)].join("")];case"colon-list-separator":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(l,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(l,y)=>y===void 0||o.skipNull&&y===null||o.skipEmptyString&&y===""?l:(y=y===null?"":y,l.length===0?[[m(u,o),d,m(y,o)].join("")]:[[l,m(y,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(l,o)].join("")]}}function f(o){let d;switch(o.arrayFormat){case"index":return(u,l,y)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){y[u]=l;return}y[u]===void 0&&(y[u]={}),y[u][d[1]]=l};case"bracket":return(u,l,y)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"colon-list-separator":return(u,l,y)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"comma":case"separator":return(u,l,y)=>{const n=typeof l=="string"&&l.includes(o.arrayFormatSeparator),g=typeof l=="string"&&!n&&E(l,o).includes(o.arrayFormatSeparator);l=g?E(l,o):l;const P=n||g?l.split(o.arrayFormatSeparator).map(j=>E(j,o)):l===null?l:E(l,o);y[u]=P};case"bracket-separator":return(u,l,y)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){y[u]=l&&E(l,o);return}const g=l===null?[]:l.split(o.arrayFormatSeparator).map(P=>E(P,o));if(y[u]===void 0){y[u]=g;return}y[u]=[].concat(y[u],g)};default:return(u,l,y)=>{if(y[u]===void 0){y[u]=l;return}y[u]=[].concat(y[u],l)}}}function _(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function E(o,d){return d.decode?r(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function U(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function I(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function R(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const u=f(d),l=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return l;for(const y of o.split("&")){if(y==="")continue;let[n,g]=i(d.decode?y.replace(/\+/g," "):y,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?g:E(g,d),u(E(n,d),g,l)}for(const y of Object.keys(l)){const n=l[y];if(typeof n=="object"&&n!==null)for(const g of Object.keys(n))n[g]=I(n[g],d);else l[y]=I(n,d)}return d.sort===!1?l:(d.sort===!0?Object.keys(l).sort():Object.keys(l).sort(d.sort)).reduce((y,n)=>{const g=l[n];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?y[n]=N(g):y[n]=g,y},Object.create(null))}t.extract=U,t.parse=R,t.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const u=g=>d.skipNull&&c(o[g])||d.skipEmptyString&&o[g]==="",l=h(d),y={};for(const g of Object.keys(o))u(g)||(y[g]=o[g]);const n=Object.keys(y);return d.sort!==!1&&n.sort(d.sort),n.map(g=>{const P=o[g];return P===void 0?"":P===null?m(g,d):Array.isArray(P)?P.length===0&&d.arrayFormat==="bracket-separator"?m(g,d)+"[]":P.reduce(l(g),[]).join("&"):m(g,d)+"="+m(P,d)}).filter(g=>g.length>0).join("&")},t.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,l]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:R(U(o),d)},d&&d.parseFragmentIdentifier&&l?{fragmentIdentifier:E(l,d)}:{})},t.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[p]:!0},d);const u=v(o.url).split("?")[0]||"",l=t.extract(o.url),y=t.parse(l,{sort:!1}),n=Object.assign(y,o.query);let g=t.stringify(n,d);g&&(g=`?${g}`);let P=D(o.url);return o.fragmentIdentifier&&(P=`#${d[p]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${g}${P}`},t.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[p]:!1},u);const{url:l,query:y,fragmentIdentifier:n}=t.parseUrl(o,u);return t.stringifyUrl({url:l,query:s(y,d),fragmentIdentifier:n},u)},t.exclude=(o,d,u)=>{const l=Array.isArray(d)?y=>!d.includes(y):(y,n)=>!d(y,n);return t.pick(o,l,u)}})(mr);const Ul={waku:{publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"},irn:{publish:"irn_publish",subscribe:"irn_subscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe"},iridium:{publish:"iridium_publish",subscribe:"iridium_subscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe"}},$a="base10",it="base16",Ci="base64pad",ss="utf8",ja=0,tr=1,Rl=0,dn=1,Pi=12,ns=32;function Fl(){const t=ts.generateKeyPair();return{privateKey:yt(t.secretKey,it),publicKey:yt(t.publicKey,it)}}function Ui(){const t=er.randomBytes(ns);return yt(t,it)}function Ml(t,e){const r=ts.sharedKey(gt(t,it),gt(e,it)),i=new ml(ei.SHA256,r).expand(ns);return yt(i,it)}function Ll(t){const e=ei.hash(gt(t,it));return yt(e,it)}function Ri(t){const e=ei.hash(gt(t,ss));return yt(e,it)}function $l(t){return gt(`${t}`,$a)}function xr(t){return Number(yt(t,$a))}function jl(t){const e=$l(typeof t.type<"u"?t.type:ja);if(xr(e)===tr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?gt(t.senderPublicKey,it):void 0,i=typeof t.iv<"u"?gt(t.iv,it):er.randomBytes(Pi),s=new Qi.ChaCha20Poly1305(gt(t.symKey,it)).seal(i,gt(t.message,ss));return Hl({type:e,sealed:s,iv:i,senderPublicKey:r})}function zl(t){const e=new Qi.ChaCha20Poly1305(gt(t.symKey,it)),{sealed:r,iv:i}=as(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return yt(s,ss)}function Hl(t){if(xr(t.type)===tr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return yt(an([t.type,t.senderPublicKey,t.iv,t.sealed]),Ci)}return yt(an([t.type,t.iv,t.sealed]),Ci)}function as(t){const e=gt(t,Ci),r=e.slice(Rl,dn),i=dn;if(xr(r)===tr){const h=i+ns,f=h+Pi,_=e.slice(i,h),m=e.slice(h,f),E=e.slice(f);return{type:r,sealed:E,iv:m,senderPublicKey:_}}const s=i+Pi,c=e.slice(i,s),p=e.slice(s);return{type:r,sealed:p,iv:c}}function ql(t,e){const r=as(t);return za({type:xr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?yt(r.senderPublicKey,it):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function za(t){const e=(t==null?void 0:t.type)||ja;if(e===tr){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function pn(t){return t.type===tr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Bl=Object.defineProperty,gn=Object.getOwnPropertySymbols,Kl=Object.prototype.hasOwnProperty,Vl=Object.prototype.propertyIsEnumerable,yn=(t,e,r)=>e in t?Bl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bn=(t,e)=>{for(var r in e||(e={}))Kl.call(e,r)&&yn(t,r,e[r]);if(gn)for(var r of gn(e))Vl.call(e,r)&&yn(t,r,e[r]);return t};const Gl="ReactNative",pr={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},kl="js";function Ha(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Wl(){return!rc()&&!!Zn()&&navigator.product===Gl}function Yl(){return!Ha()&&!!Zn()}function Jl(){return Wl()?pr.reactNative:Ha()?pr.node:Yl()?pr.browser:pr.unknown}function Xl(t,e){let r=mr.parse(t);return r=bn(bn({},r),e),t=mr.stringify(r),t}function Zl(){const t=Ol();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Ql(){var t;const e=Jl();return e===pr.browser?[e,((t=tc())==null?void 0:t.host)||"unknown"].join(":"):e}function ef(t,e,r){const i=Zl(),s=Ql();return[[t,e].join("-"),[kl,r].join("-"),i,s].join("/")}function tf({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:c}){const p=r.split("?"),h=ef(t,e,i),f={auth:s,ua:h,projectId:c},_=Xl(p[1]||"",f);return p[0]+"?"+_}function qa(t){return Object.fromEntries(t.entries())}function Ba(t){return new Map(Object.entries(t))}function gi(t,e){return J.fromMiliseconds((e||Date.now())+J.toMiliseconds(t))}function mn(t){return J.fromMiliseconds(Date.now())>=J.toMiliseconds(t)}function rf(t){const e=J.toMiliseconds(t||J.FIVE_MINUTES);let r,i,s;return{resolve:c=>{s&&r&&(clearTimeout(s),r(c))},reject:c=>{s&&i&&(clearTimeout(s),i(c))},done:()=>new Promise((c,p)=>{s=setTimeout(p,e),r=c,i=p})}}function Ka(t,e){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(),e),c=await t;clearTimeout(s),r(c)})}function Va(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function sf(t){return Va("topic",t)}function nf(t){return Va("id",t)}function af(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function yi(t,e){return`${t}${e?`:${e}`:""}`}const of="irn";function Fi(t){return(t==null?void 0:t.relay)||{protocol:of}}function Mi(t){const e=Ul[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var cf=Object.defineProperty,_n=Object.getOwnPropertySymbols,hf=Object.prototype.hasOwnProperty,uf=Object.prototype.propertyIsEnumerable,wn=(t,e,r)=>e in t?cf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lf=(t,e)=>{for(var r in e||(e={}))hf.call(e,r)&&wn(t,r,e[r]);if(_n)for(var r of _n(e))uf.call(e,r)&&wn(t,r,e[r]);return t};function ff(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const c=s.replace(i,""),p=t[s];r[c]=p}}),r}function df(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),c=typeof r<"u"?t.substring(r):"",p=mr.parse(c);return{protocol:i,topic:s[0],version:parseInt(s[1],10),symKey:p.symKey,relay:ff(p)}}function pf(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const c=r+e+s;t[s]&&(i[c]=t[s])}),i}function gf(t){return`${t.protocol}:${t.topic}@${t.version}?`+mr.stringify(lf({symKey:t.symKey},pf(t.relay)))}const yf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},bf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function xe(t,e){const{message:r,code:i}=bf[t];return{message:e?`${r} ${e}`:r,code:i}}function gr(t,e){const{message:r,code:i}=yf[t];return{message:e?`${r} ${e}`:r,code:i}}function Kr(t){return typeof t>"u"}function Ga(t,e){return e&&Kr(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function mf(t){if(Ga(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function _f(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function wf(t){return t==null?void 0:t.topic}function bi(t){return typeof t<"u"&&typeof t!==null}const En=10,Ef=()=>typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:require("ws"),vf=()=>typeof window<"u",Df=Ef();class Sf{constructor(e){if(this.url=e,this.events=new lt.exports.EventEmitter,this.registering=!1,!Is(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=()=>{this.onClose(),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(zi(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!Is(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=ic.isReactNative()?void 0:{rejectUnauthorized:!sc(e)},c=new Df(e,[],s);vf()?c.onerror=p=>{const h=p;i(this.emitError(h.error))}:c.on("error",p=>{i(this.emitError(p))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=()=>this.onClose(),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Qn(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),c=Vi(e,s);this.events.emit("payload",c)}parseError(e,r=this.url){return nc(e,r,"WS")}resetMaxListeners(){this.events.getMaxListeners()>En&&this.events.setMaxListeners(En)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for URL: ${this.url}`));return this.events.emit("register_error",r),r}}var Li={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,c=2,p=9007199254740991,h="[object Arguments]",f="[object Array]",_="[object AsyncFunction]",m="[object Boolean]",E="[object Date]",N="[object Error]",v="[object Function]",D="[object GeneratorFunction]",U="[object Map]",I="[object Number]",R="[object Null]",o="[object Object]",d="[object Promise]",u="[object Proxy]",l="[object RegExp]",y="[object Set]",n="[object String]",g="[object Symbol]",P="[object Undefined]",j="[object WeakMap]",W="[object ArrayBuffer]",Y="[object DataView]",X="[object Float32Array]",C="[object Float64Array]",T="[object Int8Array]",G="[object Int16Array]",z="[object Int32Array]",M="[object Uint8Array]",L="[object Uint8ClampedArray]",$="[object Uint16Array]",H="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,k={};k[X]=k[C]=k[T]=k[G]=k[z]=k[M]=k[L]=k[$]=k[H]=!0,k[h]=k[f]=k[W]=k[m]=k[Y]=k[E]=k[N]=k[v]=k[U]=k[I]=k[o]=k[l]=k[y]=k[n]=k[j]=!1;var oe=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,A=typeof self=="object"&&self&&self.Object===Object&&self,O=oe||A||Function("return this")(),S=e&&!e.nodeType&&e,a=S&&!0&&t&&!t.nodeType&&t,w=a&&a.exports===S,B=w&&oe.process,K=function(){try{return B&&B.binding&&B.binding("util")}catch{}}(),le=K&&K.isTypedArray;function be(b,x){for(var F=-1,V=b==null?0:b.length,Ie=0,se=[];++F<V;){var Pe=b[F];x(Pe,F,b)&&(se[Ie++]=Pe)}return se}function de(b,x){for(var F=-1,V=x.length,Ie=b.length;++F<V;)b[Ie+F]=x[F];return b}function we(b,x){for(var F=-1,V=b==null?0:b.length;++F<V;)if(x(b[F],F,b))return!0;return!1}function Ue(b,x){for(var F=-1,V=Array(b);++F<b;)V[F]=x(F);return V}function Ne(b){return function(x){return b(x)}}function ye(b,x){return b.has(x)}function pe(b,x){return b==null?void 0:b[x]}function fe(b){var x=-1,F=Array(b.size);return b.forEach(function(V,Ie){F[++x]=[Ie,V]}),F}function he(b,x){return function(F){return b(x(F))}}function ce(b){var x=-1,F=Array(b.size);return b.forEach(function(V){F[++x]=V}),F}var ae=Array.prototype,ne=Function.prototype,ee=Object.prototype,ue=O["__core-js_shared__"],ge=ne.toString,te=ee.hasOwnProperty,me=function(){var b=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return b?"Symbol(src)_1."+b:""}(),_e=ee.toString,ve=RegExp("^"+ge.call(te).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=w?O.Buffer:void 0,Ee=O.Symbol,ft=O.Uint8Array,mt=ee.propertyIsEnumerable,At=ae.splice,st=Ee?Ee.toStringTag:void 0,Lt=Object.getOwnPropertySymbols,rr=De?De.isBuffer:void 0,Ar=he(Object.keys,Object),Re=kt(O,"DataView"),Te=kt(O,"Map"),Fe=kt(O,"Promise"),Me=kt(O,"Set"),Le=kt(O,"WeakMap"),Ce=kt(Object,"create"),ze=jt(Re),He=jt(Te),qe=jt(Fe),Be=jt(Me),Ke=jt(Le),je=Ee?Ee.prototype:void 0,$e=je?je.valueOf:void 0;function Oe(b){var x=-1,F=b==null?0:b.length;for(this.clear();++x<F;){var V=b[x];this.set(V[0],V[1])}}function Ve(){this.__data__=Ce?Ce(null):{},this.size=0}function Ge(b){var x=this.has(b)&&delete this.__data__[b];return this.size-=x?1:0,x}function lo(b){var x=this.__data__;if(Ce){var F=x[b];return F===i?void 0:F}return te.call(x,b)?x[b]:void 0}function fo(b){var x=this.__data__;return Ce?x[b]!==void 0:te.call(x,b)}function po(b,x){var F=this.__data__;return this.size+=this.has(b)?0:1,F[b]=Ce&&x===void 0?i:x,this}Oe.prototype.clear=Ve,Oe.prototype.delete=Ge,Oe.prototype.get=lo,Oe.prototype.has=fo,Oe.prototype.set=po;function Dt(b){var x=-1,F=b==null?0:b.length;for(this.clear();++x<F;){var V=b[x];this.set(V[0],V[1])}}function go(){this.__data__=[],this.size=0}function yo(b){var x=this.__data__,F=Tr(x,b);if(F<0)return!1;var V=x.length-1;return F==V?x.pop():At.call(x,F,1),--this.size,!0}function bo(b){var x=this.__data__,F=Tr(x,b);return F<0?void 0:x[F][1]}function mo(b){return Tr(this.__data__,b)>-1}function _o(b,x){var F=this.__data__,V=Tr(F,b);return V<0?(++this.size,F.push([b,x])):F[V][1]=x,this}Dt.prototype.clear=go,Dt.prototype.delete=yo,Dt.prototype.get=bo,Dt.prototype.has=mo,Dt.prototype.set=_o;function $t(b){var x=-1,F=b==null?0:b.length;for(this.clear();++x<F;){var V=b[x];this.set(V[0],V[1])}}function wo(){this.size=0,this.__data__={hash:new Oe,map:new(Te||Dt),string:new Oe}}function Eo(b){var x=Cr(this,b).delete(b);return this.size-=x?1:0,x}function vo(b){return Cr(this,b).get(b)}function Do(b){return Cr(this,b).has(b)}function So(b,x){var F=Cr(this,b),V=F.size;return F.set(b,x),this.size+=F.size==V?0:1,this}$t.prototype.clear=wo,$t.prototype.delete=Eo,$t.prototype.get=vo,$t.prototype.has=Do,$t.prototype.set=So;function Nr(b){var x=-1,F=b==null?0:b.length;for(this.__data__=new $t;++x<F;)this.add(b[x])}function xo(b){return this.__data__.set(b,i),this}function Io(b){return this.__data__.has(b)}Nr.prototype.add=Nr.prototype.push=xo,Nr.prototype.has=Io;function Nt(b){var x=this.__data__=new Dt(b);this.size=x.size}function Oo(){this.__data__=new Dt,this.size=0}function Ao(b){var x=this.__data__,F=x.delete(b);return this.size=x.size,F}function No(b){return this.__data__.get(b)}function To(b){return this.__data__.has(b)}function Co(b,x){var F=this.__data__;if(F instanceof Dt){var V=F.__data__;if(!Te||V.length<r-1)return V.push([b,x]),this.size=++F.size,this;F=this.__data__=new $t(V)}return F.set(b,x),this.size=F.size,this}Nt.prototype.clear=Oo,Nt.prototype.delete=Ao,Nt.prototype.get=No,Nt.prototype.has=To,Nt.prototype.set=Co;function Po(b,x){var F=Pr(b),V=!F&&ko(b),Ie=!F&&!V&&si(b),se=!F&&!V&&!Ie&&Ss(b),Pe=F||V||Ie||se,ke=Pe?Ue(b.length,String):[],Ye=ke.length;for(var Ae in b)(x||te.call(b,Ae))&&!(Pe&&(Ae=="length"||Ie&&(Ae=="offset"||Ae=="parent")||se&&(Ae=="buffer"||Ae=="byteLength"||Ae=="byteOffset")||qo(Ae,Ye)))&&ke.push(Ae);return ke}function Tr(b,x){for(var F=b.length;F--;)if(ws(b[F][0],x))return F;return-1}function Uo(b,x,F){var V=x(b);return Pr(b)?V:de(V,F(b))}function ir(b){return b==null?b===void 0?P:R:st&&st in Object(b)?zo(b):Go(b)}function ys(b){return sr(b)&&ir(b)==h}function bs(b,x,F,V,Ie){return b===x?!0:b==null||x==null||!sr(b)&&!sr(x)?b!==b&&x!==x:Ro(b,x,F,V,bs,Ie)}function Ro(b,x,F,V,Ie,se){var Pe=Pr(b),ke=Pr(x),Ye=Pe?f:Tt(b),Ae=ke?f:Tt(x);Ye=Ye==h?o:Ye,Ae=Ae==h?o:Ae;var nt=Ye==o,dt=Ae==o,Ze=Ye==Ae;if(Ze&&si(b)){if(!si(x))return!1;Pe=!0,nt=!1}if(Ze&&!nt)return se||(se=new Nt),Pe||Ss(b)?ms(b,x,F,V,Ie,se):$o(b,x,Ye,F,V,Ie,se);if(!(F&s)){var ct=nt&&te.call(b,"__wrapped__"),ht=dt&&te.call(x,"__wrapped__");if(ct||ht){var Ct=ct?b.value():b,St=ht?x.value():x;return se||(se=new Nt),Ie(Ct,St,F,V,se)}}return Ze?(se||(se=new Nt),jo(b,x,F,V,Ie,se)):!1}function Fo(b){if(!Ds(b)||Ko(b))return!1;var x=Es(b)?ve:q;return x.test(jt(b))}function Mo(b){return sr(b)&&vs(b.length)&&!!k[ir(b)]}function Lo(b){if(!Vo(b))return Ar(b);var x=[];for(var F in Object(b))te.call(b,F)&&F!="constructor"&&x.push(F);return x}function ms(b,x,F,V,Ie,se){var Pe=F&s,ke=b.length,Ye=x.length;if(ke!=Ye&&!(Pe&&Ye>ke))return!1;var Ae=se.get(b);if(Ae&&se.get(x))return Ae==x;var nt=-1,dt=!0,Ze=F&c?new Nr:void 0;for(se.set(b,x),se.set(x,b);++nt<ke;){var ct=b[nt],ht=x[nt];if(V)var Ct=Pe?V(ht,ct,nt,x,b,se):V(ct,ht,nt,b,x,se);if(Ct!==void 0){if(Ct)continue;dt=!1;break}if(Ze){if(!we(x,function(St,zt){if(!ye(Ze,zt)&&(ct===St||Ie(ct,St,F,V,se)))return Ze.push(zt)})){dt=!1;break}}else if(!(ct===ht||Ie(ct,ht,F,V,se))){dt=!1;break}}return se.delete(b),se.delete(x),dt}function $o(b,x,F,V,Ie,se,Pe){switch(F){case Y:if(b.byteLength!=x.byteLength||b.byteOffset!=x.byteOffset)return!1;b=b.buffer,x=x.buffer;case W:return!(b.byteLength!=x.byteLength||!se(new ft(b),new ft(x)));case m:case E:case I:return ws(+b,+x);case N:return b.name==x.name&&b.message==x.message;case l:case n:return b==x+"";case U:var ke=fe;case y:var Ye=V&s;if(ke||(ke=ce),b.size!=x.size&&!Ye)return!1;var Ae=Pe.get(b);if(Ae)return Ae==x;V|=c,Pe.set(b,x);var nt=ms(ke(b),ke(x),V,Ie,se,Pe);return Pe.delete(b),nt;case g:if($e)return $e.call(b)==$e.call(x)}return!1}function jo(b,x,F,V,Ie,se){var Pe=F&s,ke=_s(b),Ye=ke.length,Ae=_s(x),nt=Ae.length;if(Ye!=nt&&!Pe)return!1;for(var dt=Ye;dt--;){var Ze=ke[dt];if(!(Pe?Ze in x:te.call(x,Ze)))return!1}var ct=se.get(b);if(ct&&se.get(x))return ct==x;var ht=!0;se.set(b,x),se.set(x,b);for(var Ct=Pe;++dt<Ye;){Ze=ke[dt];var St=b[Ze],zt=x[Ze];if(V)var xs=Pe?V(zt,St,Ze,x,b,se):V(St,zt,Ze,b,x,se);if(!(xs===void 0?St===zt||Ie(St,zt,F,V,se):xs)){ht=!1;break}Ct||(Ct=Ze=="constructor")}if(ht&&!Ct){var Ur=b.constructor,Rr=x.constructor;Ur!=Rr&&"constructor"in b&&"constructor"in x&&!(typeof Ur=="function"&&Ur instanceof Ur&&typeof Rr=="function"&&Rr instanceof Rr)&&(ht=!1)}return se.delete(b),se.delete(x),ht}function _s(b){return Uo(b,Jo,Ho)}function Cr(b,x){var F=b.__data__;return Bo(x)?F[typeof x=="string"?"string":"hash"]:F.map}function kt(b,x){var F=pe(b,x);return Fo(F)?F:void 0}function zo(b){var x=te.call(b,st),F=b[st];try{b[st]=void 0;var V=!0}catch{}var Ie=_e.call(b);return V&&(x?b[st]=F:delete b[st]),Ie}var Ho=Lt?function(b){return b==null?[]:(b=Object(b),be(Lt(b),function(x){return mt.call(b,x)}))}:Xo,Tt=ir;(Re&&Tt(new Re(new ArrayBuffer(1)))!=Y||Te&&Tt(new Te)!=U||Fe&&Tt(Fe.resolve())!=d||Me&&Tt(new Me)!=y||Le&&Tt(new Le)!=j)&&(Tt=function(b){var x=ir(b),F=x==o?b.constructor:void 0,V=F?jt(F):"";if(V)switch(V){case ze:return Y;case He:return U;case qe:return d;case Be:return y;case Ke:return j}return x});function qo(b,x){return x=x==null?p:x,!!x&&(typeof b=="number"||Z.test(b))&&b>-1&&b%1==0&&b<x}function Bo(b){var x=typeof b;return x=="string"||x=="number"||x=="symbol"||x=="boolean"?b!=="__proto__":b===null}function Ko(b){return!!me&&me in b}function Vo(b){var x=b&&b.constructor,F=typeof x=="function"&&x.prototype||ee;return b===F}function Go(b){return _e.call(b)}function jt(b){if(b!=null){try{return ge.call(b)}catch{}try{return b+""}catch{}}return""}function ws(b,x){return b===x||b!==b&&x!==x}var ko=ys(function(){return arguments}())?ys:function(b){return sr(b)&&te.call(b,"callee")&&!mt.call(b,"callee")},Pr=Array.isArray;function Wo(b){return b!=null&&vs(b.length)&&!Es(b)}var si=rr||Zo;function Yo(b,x){return bs(b,x)}function Es(b){if(!Ds(b))return!1;var x=ir(b);return x==v||x==D||x==_||x==u}function vs(b){return typeof b=="number"&&b>-1&&b%1==0&&b<=p}function Ds(b){var x=typeof b;return b!=null&&(x=="object"||x=="function")}function sr(b){return b!=null&&typeof b=="object"}var Ss=le?Ne(le):Mo;function Jo(b){return Wo(b)?Po(b):Lo(b)}function Xo(){return[]}function Zo(){return!1}t.exports=Yo})(Li,Li.exports);const xf=Li.exports;function If(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=s}var h=t.length,f=t.charAt(0),_=Math.log(h)/Math.log(256),m=Math.log(256)/Math.log(h);function E(D){if(D instanceof Uint8Array||(ArrayBuffer.isView(D)?D=new Uint8Array(D.buffer,D.byteOffset,D.byteLength):Array.isArray(D)&&(D=Uint8Array.from(D))),!(D instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(D.length===0)return"";for(var U=0,I=0,R=0,o=D.length;R!==o&&D[R]===0;)R++,U++;for(var d=(o-R)*m+1>>>0,u=new Uint8Array(d);R!==o;){for(var l=D[R],y=0,n=d-1;(l!==0||y<I)&&n!==-1;n--,y++)l+=256*u[n]>>>0,u[n]=l%h>>>0,l=l/h>>>0;if(l!==0)throw new Error("Non-zero carry");I=y,R++}for(var g=d-I;g!==d&&u[g]===0;)g++;for(var P=f.repeat(U);g<d;++g)P+=t.charAt(u[g]);return P}function N(D){if(typeof D!="string")throw new TypeError("Expected String");if(D.length===0)return new Uint8Array;var U=0;if(D[U]!==" "){for(var I=0,R=0;D[U]===f;)I++,U++;for(var o=(D.length-U)*_+1>>>0,d=new Uint8Array(o);D[U];){var u=r[D.charCodeAt(U)];if(u===255)return;for(var l=0,y=o-1;(u!==0||l<R)&&y!==-1;y--,l++)u+=h*d[y]>>>0,d[y]=u%256>>>0,u=u/256>>>0;if(u!==0)throw new Error("Non-zero carry");R=l,U++}if(D[U]!==" "){for(var n=o-R;n!==o&&d[n]===0;)n++;for(var g=new Uint8Array(I+(o-n)),P=I;n!==o;)g[P++]=d[n++];return g}}}function v(D){var U=N(D);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:E,decodeUnsafe:N,decode:v}}var Of=If,Af=Of;const ka=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Nf=t=>new TextEncoder().encode(t),Tf=t=>new TextDecoder().decode(t);class Cf{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Pf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wa(this,e)}}class Uf{constructor(e){this.decoders=e}or(e){return Wa(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wa=(t,e)=>new Uf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Rf{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new Cf(e,r,i),this.decoder=new Pf(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:i})=>new Rf(t,e,r,i),Ir=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=Af(r,e);return ti({prefix:t,name:e,encode:i,decode:c=>ka(s(c))})},Ff=(t,e,r,i)=>{const s={};for(let m=0;m<e.length;++m)s[e[m]]=m;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let h=0,f=0,_=0;for(let m=0;m<c;++m){const E=s[t[m]];if(E===void 0)throw new SyntaxError(`Non-${i} character`);f=f<<r|E,h+=r,h>=8&&(h-=8,p[_++]=255&f>>h)}if(h>=r||255&f<<8-h)throw new SyntaxError("Unexpected end of data");return p},Mf=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",p=0,h=0;for(let f=0;f<t.length;++f)for(h=h<<8|t[f],p+=8;p>r;)p-=r,c+=e[s&h>>p];if(p&&(c+=e[s&h<<r-p]),i)for(;c.length*r&7;)c+="=";return c},Xe=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>ti({prefix:e,name:t,encode(s){return Mf(s,i,r)},decode(s){return Ff(s,i,r,t)}}),Lf=ti({prefix:"\0",name:"identity",encode:t=>Tf(t),decode:t=>Nf(t)});var $f=Object.freeze({__proto__:null,identity:Lf});const jf=Xe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var zf=Object.freeze({__proto__:null,base2:jf});const Hf=Xe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var qf=Object.freeze({__proto__:null,base8:Hf});const Bf=Ir({prefix:"9",name:"base10",alphabet:"0123456789"});var Kf=Object.freeze({__proto__:null,base10:Bf});const Vf=Xe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gf=Xe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var kf=Object.freeze({__proto__:null,base16:Vf,base16upper:Gf});const Wf=Xe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Yf=Xe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Jf=Xe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Xf=Xe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Zf=Xe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Qf=Xe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ed=Xe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),td=Xe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rd=Xe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var id=Object.freeze({__proto__:null,base32:Wf,base32upper:Yf,base32pad:Jf,base32padupper:Xf,base32hex:Zf,base32hexupper:Qf,base32hexpad:ed,base32hexpadupper:td,base32z:rd});const sd=Ir({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),nd=Ir({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ad=Object.freeze({__proto__:null,base36:sd,base36upper:nd});const od=Ir({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),cd=Ir({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var hd=Object.freeze({__proto__:null,base58btc:od,base58flickr:cd});const ud=Xe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ld=Xe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),fd=Xe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),dd=Xe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var pd=Object.freeze({__proto__:null,base64:ud,base64pad:ld,base64url:fd,base64urlpad:dd});const Ya=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),gd=Ya.reduce((t,e,r)=>(t[r]=e,t),[]),yd=Ya.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function bd(t){return t.reduce((e,r)=>(e+=gd[r],e),"")}function md(t){const e=[];for(const r of t){const i=yd[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const _d=ti({prefix:"\u{1F680}",name:"base256emoji",encode:bd,decode:md});var wd=Object.freeze({__proto__:null,base256emoji:_d}),Ed=Ja,vn=128,vd=127,Dd=~vd,Sd=Math.pow(2,31);function Ja(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Sd;)e[r++]=t&255|vn,t/=128;for(;t&Dd;)e[r++]=t&255|vn,t>>>=7;return e[r]=t|0,Ja.bytes=r-i+1,e}var xd=$i,Id=128,Dn=127;function $i(t,i){var r=0,i=i||0,s=0,c=i,p,h=t.length;do{if(c>=h)throw $i.bytes=0,new RangeError("Could not decode varint");p=t[c++],r+=s<28?(p&Dn)<<s:(p&Dn)*Math.pow(2,s),s+=7}while(p>=Id);return $i.bytes=c-i,r}var Od=Math.pow(2,7),Ad=Math.pow(2,14),Nd=Math.pow(2,21),Td=Math.pow(2,28),Cd=Math.pow(2,35),Pd=Math.pow(2,42),Ud=Math.pow(2,49),Rd=Math.pow(2,56),Fd=Math.pow(2,63),Md=function(t){return t<Od?1:t<Ad?2:t<Nd?3:t<Td?4:t<Cd?5:t<Pd?6:t<Ud?7:t<Rd?8:t<Fd?9:10},Ld={encode:Ed,decode:xd,encodingLength:Md},Xa=Ld;const Sn=(t,e,r=0)=>(Xa.encode(t,e,r),e),xn=t=>Xa.encodingLength(t),ji=(t,e)=>{const r=e.byteLength,i=xn(t),s=i+xn(r),c=new Uint8Array(s+r);return Sn(t,c,0),Sn(r,c,i),c.set(e,s),new $d(t,r,e,c)};class $d{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const Za=({name:t,code:e,encode:r})=>new jd(t,e,r);class jd{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?ji(this.code,r):r.then(i=>ji(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Qa=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),zd=Za({name:"sha2-256",code:18,encode:Qa("SHA-256")}),Hd=Za({name:"sha2-512",code:19,encode:Qa("SHA-512")});var qd=Object.freeze({__proto__:null,sha256:zd,sha512:Hd});const eo=0,Bd="identity",to=ka,Kd=t=>ji(eo,to(t)),Vd={code:eo,name:Bd,encode:to,digest:Kd};var Gd=Object.freeze({__proto__:null,identity:Vd});new TextEncoder,new TextDecoder;const In={...$f,...zf,...qf,...Kf,...kf,...id,...ad,...hd,...pd,...wd};({...qd,...Gd});function kd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}function ro(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const On=ro("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),mi=ro("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=kd(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Wd={utf8:On,"utf-8":On,hex:In.base16,latin1:mi,ascii:mi,binary:mi,...In};function Yd(t,e="utf8"){const r=Wd[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t,"utf8"):r.decoder.decode(`${r.prefix}${t}`)}const io="wc",Jd=2,os="core",Rt=`${io}@${2}:${os}:`,Xd={name:os,logger:"error"},Zd={database:":memory:"},Qd="crypto",An="client_ed25519_seed",ep=J.ONE_DAY,tp="keychain",rp="0.3",ip="messages",sp="0.3",np=J.SIX_HOURS,ap="publisher",so="irn",op="error",cp="wss://relay.walletconnect.com",hp="relayer",et={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},up="_subscription",Mr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Nn=J.ONE_SECOND,lp="2.3.3",fp="0.3",Et={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},dp="subscription",pp="0.3",gp=J.FIVE_SECONDS*1e3,yp="pairing",bp="0.3",fr={wc_pairingDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:J.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:J.ONE_DAY,prompt:!1,tag:0},res:{ttl:J.ONE_DAY,prompt:!1,tag:0}}},wt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},mp="history",_p="0.3",wp="expirer",ut={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ep="0.3";class vp{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=tp,this.version=rp,this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:c}=xe("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,qa(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ba(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Dp{constructor(e,r,i){this.core=e,this.logger=r,this.name=Qd,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=rn(s);return Na(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Fl();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),p=rn(c),h=Ui();return await nl(h,s,ep,p)},this.generateSharedKey=(s,c,p)=>{this.isInitialized();const h=this.getPrivateKey(s),f=Ml(h,c);return this.setSymKey(f,p)},this.setSymKey=async(s,c)=>{this.isInitialized();const p=c||Ll(s);return await this.keychain.set(p,s),p},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,p)=>{this.isInitialized();const h=za(p),f=zi(c);if(pn(h)){const N=h.senderPublicKey,v=h.receiverPublicKey;s=await this.generateSharedKey(N,v)}const _=this.getSymKey(s),{type:m,senderPublicKey:E}=h;return jl({type:m,symKey:_,message:f,senderPublicKey:E})},this.decode=async(s,c,p)=>{this.isInitialized();const h=ql(c,p);if(pn(h)){const m=h.receiverPublicKey,E=h.senderPublicKey;s=await this.generateSharedKey(m,E)}const f=this.getSymKey(s),_=zl({symKey:f,encoded:c});return Qn(_)},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new vp(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}getPayloadType(e){const r=as(e);return xr(r.type)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(An)}catch{e=Ui(),await this.keychain.set(An,e)}return Yd(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Sp extends Kc{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=ip,this.version=sp,this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const c=Ri(s);let p=this.messages.get(i);return typeof p>"u"&&(p={}),typeof p[c]<"u"||(p[c]=s,this.messages.set(i,p),await this.persist()),c},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const c=this.get(i),p=Ri(s);return typeof c[p]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,qa(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ba(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class xp extends Vc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new lt.exports.EventEmitter,this.name=ap,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,c)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}});try{const p=(c==null?void 0:c.ttl)||np,h=Fi(c),f=(c==null?void 0:c.prompt)||!1,_=(c==null?void 0:c.tag)||0,m={topic:i,message:s,opts:{ttl:p,relay:h,prompt:f,tag:_}},E=Ri(s);this.queue.set(E,m);try{await await Ka(this.rpcPublish(i,s,p,h,f,_),this.publishTimeout),this.relayer.events.emit(et.publish,m)}catch{this.logger.debug("Publishing Payload stalled"),this.relayer.events.emit(et.connection_stalled);return}this.onPublish(E,m),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}})}catch(p){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(p),p}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,c,p){var h,f,_,m;const E={method:Mi(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:c,tag:p}};return Kr((h=E.params)==null?void 0:h.prompt)&&((f=E.params)==null||delete f.prompt),Kr((_=E.params)==null?void 0:_.tag)&&((m=E.params)==null||delete m.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:E}),this.relayer.provider.request(E)}onPublish(e,r){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(vr.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Ip{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(c=>c!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Op=Object.defineProperty,Ap=Object.defineProperties,Np=Object.getOwnPropertyDescriptors,Tn=Object.getOwnPropertySymbols,Tp=Object.prototype.hasOwnProperty,Cp=Object.prototype.propertyIsEnumerable,Cn=(t,e,r)=>e in t?Op(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lr=(t,e)=>{for(var r in e||(e={}))Tp.call(e,r)&&Cn(t,r,e[r]);if(Tn)for(var r of Tn(e))Cp.call(e,r)&&Cn(t,r,e[r]);return t},_i=(t,e)=>Ap(t,Np(e));class Pp extends Wc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Ip,this.events=new lt.exports.EventEmitter,this.name=dp,this.version=pp,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=Rt,this.subscribeTimeout=1e4,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,s)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const c=Fi(s),p={topic:i,relay:c};this.pending.set(i,p);const h=await this.rpcSubscribe(i,c);return this.onSubscribe(h,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),h}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,c)=>{const p=new J.Watch;p.start(this.pendingSubscriptionWatchLabel);const h=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(h),p.stop(this.pendingSubscriptionWatchLabel),s(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=gp&&(clearInterval(h),p.stop(this.pendingSubscriptionWatchLabel),c(!1))},this.pendingSubInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{await this.restore(),await this.reset()},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Fi(i);await this.rpcUnsubscribe(e,r,s);const c=gr("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:Mi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let s;try{s=await await Ka(this.relayer.provider.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(et.connection_stalled)}return s}rpcUnsubscribe(e,r,i){const s={method:Mi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.provider.request(s)}onSubscribe(e,r){this.setSubscription(e,_i(Lr({},r),{id:e})),this.pending.delete(r.topic)}onResubscribe(e,r){this.addSubscription(e,_i(Lr({},r),{id:e})),this.pending.delete(r.topic)}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,Lr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Et.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=xe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Et.deleted,_i(Lr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Et.sync)}async reset(){this.cached.length&&await Promise.all(this.cached.map(async e=>await this.resubscribe(e))),this.events.emit(Et.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=xe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:r,relay:i}=e,s={topic:r,relay:i};this.pending.set(s.topic,s);const c=await this.rpcSubscribe(s.topic,s.relay);this.onResubscribe(c,s)}}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.relayer.transportExplicitlyClosed||this.pending.forEach(async e=>{const r=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(r,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(vr.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.on(et.connect,async()=>{await this.onConnect()}),this.relayer.on(et.disconnect,()=>{this.onDisconnect()}),this.events.on(Et.created,async e=>{const r=Et.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Et.deleted,async e=>{const r=Et.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Up=Object.defineProperty,Pn=Object.getOwnPropertySymbols,Rp=Object.prototype.hasOwnProperty,Fp=Object.prototype.propertyIsEnumerable,Un=(t,e,r)=>e in t?Up(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mp=(t,e)=>{for(var r in e||(e={}))Rp.call(e,r)&&Un(t,r,e[r]);if(Pn)for(var r of Pn(e))Fp.call(e,r)&&Un(t,r,e[r]);return t};class Lp extends Gc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new lt.exports.EventEmitter,this.name=hp,this.transportExplicitlyClosed=!1,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):wr(Se.getDefaultLoggerOptions({level:e.logger||op})),this.messages=new Sp(this.logger,e.core),this.subscriber=new Pp(this,this.logger),this.publisher=new xp(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||cp,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.provider=await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r})}async subscribe(e,r){this.isInitialized();let i="";return await Promise.all([new Promise(s=>{this.subscriber.once(Et.created,c=>{c.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,r),s()})]),i}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(et.transport_closed))}async transportOpen(e){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once(Et.resubscribed,()=>{r()})}),await Promise.race([this.provider.connect(),new Promise((r,i)=>this.once(et.transport_closed,()=>{i(new Error("closeTransport called before connection was established"))}))])])}catch(r){const i=r;if(!/socket hang up/i.test(i.message))throw new Error(i.message);this.logger.error(i),this.events.emit(et.transport_closed)}}async restartTransport(e){await this.transportClose(),await new Promise(r=>setTimeout(r,Nn)),await this.transportOpen(e)}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);return new _r(new Sf(tf({sdkVersion:lp,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;return await this.subscriber.isSubscribed(r)?this.messages.has(r,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Gi(e)){if(!e.method.endsWith(up))return;const r=e.params,{topic:i,message:s}=r.data,c={topic:i,message:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Mp({type:"event",event:r.id},c)),this.events.emit(r.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(et.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=ki(e.id,!0);await this.provider.connection.send(r)}registerEventListeners(){this.provider.on(Mr.payload,e=>this.onProviderPayload(e)),this.provider.on(Mr.connect,()=>{this.events.emit(et.connect)}),this.provider.on(Mr.disconnect,()=>{this.events.emit(et.disconnect),this.attemptToReconnect()}),this.provider.on(Mr.error,e=>this.events.emit(et.error,e)),this.events.on(et.connection_stalled,async()=>{await this.restartTransport()})}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.transportOpen()},J.toMiliseconds(Nn))}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var $p=Object.defineProperty,Rn=Object.getOwnPropertySymbols,jp=Object.prototype.hasOwnProperty,zp=Object.prototype.propertyIsEnumerable,Fn=(t,e,r)=>e in t?$p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mn=(t,e)=>{for(var r in e||(e={}))jp.call(e,r)&&Fn(t,r,e[r]);if(Rn)for(var r of Rn(e))zp.call(e,r)&&Fn(t,r,e[r]);return t};class ri extends kc{constructor(e,r,i,s=Rt,c=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=fp,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{_f(p)?this.map.set(p.id,p):wf(p)?this.map.set(p.topic,p):this.getKey&&p!==null&&!Kr(p)&&this.map.set(this.getKey(p),p)}),this.cached=[],this.initialized=!0)},this.set=async(p,h)=>{this.isInitialized(),this.map.has(p)?await this.update(p,h):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:h}),this.map.set(p,h),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(h=>Object.keys(p).every(f=>xf(h[f],p[f]))):this.values),this.update=async(p,h)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:h});const f=Mn(Mn({},this.getData(p)),h);this.map.set(p,f),await this.persist()},this.delete=async(p,h)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:h}),this.map.delete(p),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=xe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=xe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Hp{constructor(e,r){this.core=e,this.logger=r,this.name=yp,this.version=bp,this.events=new lt.exports,this.initialized=!1,this.storagePrefix=Rt,this.ignoredPayloadTypes=[tr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Ui(),s=await this.core.crypto.setSymKey(i),c=gi(J.FIVE_MINUTES),p={protocol:so},h={topic:s,expiry:c,relay:p,active:!1},f=gf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:p});return await this.pairings.set(s,h),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:f}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:c,relay:p}=df(i.uri),h=gi(J.FIVE_MINUTES),f={topic:s,relay:p,expiry:h,active:!1};return await this.pairings.set(s,f),await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:p}),this.core.expirer.set(s,h),i.activatePairing&&await this.activate({topic:s}),f},this.activate=async({topic:i})=>{this.isInitialized();const s=gi(J.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:p,resolve:h,reject:f}=rf();this.events.once(yi("pairing_ping",c),({error:_})=>{_?f(_):h()}),await p()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",gr("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,c)=>{const p=Wi(s,c),h=await this.core.crypto.encode(i,p),f=fr[s].req;return this.core.history.set(i,p),await this.core.relayer.publish(i,h,f),p.id},this.sendResult=async(i,s,c)=>{const p=ki(i,c),h=await this.core.crypto.encode(s,p),f=await this.core.history.get(s,i),_=fr[f.request.method].res;await this.core.relayer.publish(s,h,_),await this.core.history.resolve(p)},this.sendError=async(i,s,c)=>{const p=Vi(i,c),h=await this.core.crypto.encode(s,p),f=await this.core.history.get(s,i),_=fr[f.request.method]?fr[f.request.method].res:fr.unregistered_method.res;await this.core.relayer.publish(s,h,_),await this.core.history.resolve(p)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,gr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>mn(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:c}=i,p=c.method;if(this.pairings.keys.includes(s))switch(p){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:c}=i,p=(await this.core.history.get(s,c.id)).request.method;if(this.pairings.keys.includes(s))switch(p){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(i,s)=>{const{id:c}=s;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit("pairing_ping",{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onPairingPingResponse=(i,s)=>{const{id:c}=s;setTimeout(()=>{Pt(s)?this.events.emit(yi("pairing_ping",c),{}):It(s)&&this.events.emit(yi("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:i}),await this.sendResult(c,i,!0),await this.deletePairing(i),this.events.emit("pairing_delete",{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:c,method:p}=s;try{if(this.registeredMethods.includes(p))return;const h=gr("WC_METHOD_UNSUPPORTED",p);await this.sendError(c,i,h),this.logger.error(h)}catch(h){await this.sendError(c,i,h),this.logger.error(h)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(gr("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!bi(i)){const{message:s}=xe("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!mf(i.uri)){const{message:s}=xe("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!bi(i)){const{message:c}=xe("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!bi(i)){const{message:c}=xe("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!Ga(i,!1)){const{message:s}=xe("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=xe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(mn(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=xe("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new ri(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(et.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);Gi(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):ea(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(ut.expired,async e=>{const{topic:r}=af(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class qp extends Bc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new lt.exports.EventEmitter,this.name=mp,this.version=_p,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:c}),this.records.has(s.id))return;const p={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:c};this.records.set(p.id,p),this.events.emit(wt.created,p)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=It(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(wt.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===i){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(wt.deleted,c)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Wi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=xe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(wt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=xe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(wt.created,e=>{const r=wt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(wt.updated,e=>{const r=wt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(wt.deleted,e=>{const r=wt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Bp extends Yc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new lt.exports.EventEmitter,this.name=wp,this.version=Ep,this.cached=[],this.initialized=!1,this.storagePrefix=Rt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const c=this.formatTarget(i),p={target:c,expiry:s};this.expirations.set(c,p),this.checkExpiry(c,p),this.events.emit(ut.created,{target:c,expiration:p})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(ut.deleted,{target:s,expiration:c})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return sf(e);if(typeof e=="number")return nf(e);const{message:r}=xe("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(ut.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=xe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=xe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;J.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(ut.expired,{target:e,expiration:r})}checkExpirations(){this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(vr.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(ut.created,e=>{const r=ut.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.expired,e=>{const r=ut.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(ut.deleted,e=>{const r=ut.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=xe("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Kp=Object.defineProperty,Ln=Object.getOwnPropertySymbols,Vp=Object.prototype.hasOwnProperty,Gp=Object.prototype.propertyIsEnumerable,$n=(t,e,r)=>e in t?Kp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jn=(t,e)=>{for(var r in e||(e={}))Vp.call(e,r)&&$n(t,r,e[r]);if(Ln)for(var r of Ln(e))Gp.call(e,r)&&$n(t,r,e[r]);return t};class cs extends qc{constructor(e){super(e),this.protocol=io,this.version=Jd,this.name=os,this.events=new lt.exports.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:wr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Xd.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new vr.HeartBeat,this.crypto=new Dp(this,this.logger,e==null?void 0:e.keychain),this.history=new qp(this,this.logger),this.expirer=new Bp(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Oc(jn(jn({},Zd),e==null?void 0:e.storageOptions)),this.relayer=new Lp({core:this,logger:this.logger,relayUrl:e==null?void 0:e.relayUrl,projectId:this.projectId}),this.pairing=new Hp(this,this.logger)}static async init(e){const r=new cs(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const kp=cs;class Wp{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Yp{constructor(e){this.client=e}}var hs={};Object.defineProperty(hs,"__esModule",{value:!0});var no=hs.getWindowMetadata=void 0;const zn=Hi;function Jp(){let t,e;try{t=zn.getDocumentOrThrow(),e=zn.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),N=[];for(let v=0;v<E.length;v++){const D=E[v],U=D.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const I=D.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(I.indexOf("/")===0)R+=I;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");R+=d+"/"+I}N.push(R)}else if(I.indexOf("//")===0){const R=e.protocol+I;N.push(R)}else N.push(I)}}return N}function i(...E){const N=t.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],U=["itemprop","property","name"].map(I=>D.getAttribute(I)).filter(I=>I?E.includes(I):!1);if(U.length&&U){const I=D.getAttribute("content");if(I)return I}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),h=c(),f=e.origin,_=r();return{description:h,url:f,icons:_,name:p}}no=hs.getWindowMetadata=Jp;var Xp={};(function(t){const e=Bi,r=Ki,i=qi,s=is,c=o=>o==null,p=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,l)=>{const y=u.length;return l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[",y,"]"].join("")]:[...u,[m(d,o),"[",m(y,o),"]=",m(l,o)].join("")]};case"bracket":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(l,o)].join("")];case"colon-list-separator":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(l,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(l,y)=>y===void 0||o.skipNull&&y===null||o.skipEmptyString&&y===""?l:(y=y===null?"":y,l.length===0?[[m(u,o),d,m(y,o)].join("")]:[[l,m(y,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(l,o)].join("")]}}function f(o){let d;switch(o.arrayFormat){case"index":return(u,l,y)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){y[u]=l;return}y[u]===void 0&&(y[u]={}),y[u][d[1]]=l};case"bracket":return(u,l,y)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"colon-list-separator":return(u,l,y)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"comma":case"separator":return(u,l,y)=>{const n=typeof l=="string"&&l.includes(o.arrayFormatSeparator),g=typeof l=="string"&&!n&&E(l,o).includes(o.arrayFormatSeparator);l=g?E(l,o):l;const P=n||g?l.split(o.arrayFormatSeparator).map(j=>E(j,o)):l===null?l:E(l,o);y[u]=P};case"bracket-separator":return(u,l,y)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){y[u]=l&&E(l,o);return}const g=l===null?[]:l.split(o.arrayFormatSeparator).map(P=>E(P,o));if(y[u]===void 0){y[u]=g;return}y[u]=[].concat(y[u],g)};default:return(u,l,y)=>{if(y[u]===void 0){y[u]=l;return}y[u]=[].concat(y[u],l)}}}function _(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function E(o,d){return d.decode?r(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function U(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function I(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function R(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const u=f(d),l=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return l;for(const y of o.split("&")){if(y==="")continue;let[n,g]=i(d.decode?y.replace(/\+/g," "):y,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?g:E(g,d),u(E(n,d),g,l)}for(const y of Object.keys(l)){const n=l[y];if(typeof n=="object"&&n!==null)for(const g of Object.keys(n))n[g]=I(n[g],d);else l[y]=I(n,d)}return d.sort===!1?l:(d.sort===!0?Object.keys(l).sort():Object.keys(l).sort(d.sort)).reduce((y,n)=>{const g=l[n];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?y[n]=N(g):y[n]=g,y},Object.create(null))}t.extract=U,t.parse=R,t.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const u=g=>d.skipNull&&c(o[g])||d.skipEmptyString&&o[g]==="",l=h(d),y={};for(const g of Object.keys(o))u(g)||(y[g]=o[g]);const n=Object.keys(y);return d.sort!==!1&&n.sort(d.sort),n.map(g=>{const P=o[g];return P===void 0?"":P===null?m(g,d):Array.isArray(P)?P.length===0&&d.arrayFormat==="bracket-separator"?m(g,d)+"[]":P.reduce(l(g),[]).join("&"):m(g,d)+"="+m(P,d)}).filter(g=>g.length>0).join("&")},t.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,l]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:R(U(o),d)},d&&d.parseFragmentIdentifier&&l?{fragmentIdentifier:E(l,d)}:{})},t.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[p]:!0},d);const u=v(o.url).split("?")[0]||"",l=t.extract(o.url),y=t.parse(l,{sort:!1}),n=Object.assign(y,o.query);let g=t.stringify(n,d);g&&(g=`?${g}`);let P=D(o.url);return o.fragmentIdentifier&&(P=`#${d[p]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${g}${P}`},t.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[p]:!1},u);const{url:l,query:y,fragmentIdentifier:n}=t.parseUrl(o,u);return t.stringifyUrl({url:l,query:s(y,d),fragmentIdentifier:n},u)},t.exclude=(o,d,u)=>{const l=Array.isArray(d)?y=>!d.includes(y):(y,n)=>!d(y,n);return t.pick(o,l,u)}})(Xp);const Zp=1;function Qp(){return no()||{name:"",description:"",url:"",icons:[""]}}function Ut(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Vt(t,e){return J.fromMiliseconds((e||Date.now())+J.toMiliseconds(t))}function Xt(t){return J.fromMiliseconds(Date.now())>=J.toMiliseconds(t)}function Zt(t){const e=J.toMiliseconds(t||J.FIVE_MINUTES);let r,i,s;return{resolve:c=>{s&&r&&(clearTimeout(s),r(c))},reject:c=>{s&&i&&(clearTimeout(s),i(c))},done:()=>new Promise((c,p)=>{s=setTimeout(p,e),r=c,i=p})}}function eg(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function We(t,e){return`${t}${e?`:${e}`:""}`}function Or(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function tg(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Or(r.accounts))}),e}function rg(t,e){const r=[];return Object.values(t).forEach(i=>{Or(i.accounts).includes(e)&&r.push(...i.methods)}),r}function ig(t,e){const r=[];return Object.values(t).forEach(i=>{Or(i.accounts).includes(e)&&r.push(...i.events)}),r}function sg(t,e){const r=jr(t,e);if(r)throw new Error(r.message);const i={};for(const[s,c]of Object.entries(t))i[s]={methods:c.methods,events:c.events,chains:c.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return i}const ng={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},ag={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function Q(t,e){const{message:r,code:i}=ag[t];return{message:e?`${r} ${e}`:r,code:i}}function at(t,e){const{message:r,code:i}=ng[t];return{message:e?`${r} ${e}`:r,code:i}}function ii(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Vr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ot(t){return typeof t>"u"}function rt(t,e){return e&&Ot(t)?!0:typeof t=="string"&&Boolean(t.trim().length)}function us(t,e){return e&&Ot(t)?!0:typeof t=="number"&&!isNaN(t)}function og(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let c=!0;return Ut(s,i)?(i.forEach(p=>{const{accounts:h,methods:f,events:_}=t.namespaces[p],m=Or(h),E=r[p];(!Ut(E.chains,m)||!Ut(E.methods,f)||!Ut(E.events,_))&&(c=!1)}),c):!1}function ls(t){return rt(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function cg(t){if(rt(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&ls(r)}}return!1}function hg(t,e){let r=null;return rt(t==null?void 0:t.publicKey,!1)||(r=Q("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Hn(t){let e=!0;return ii(t)?t.length&&(e=t.every(r=>rt(r,!1))):e=!1,e}function ug(t,e,r){let i=null;return ii(e)?e.forEach(s=>{i||(!ls(s)||!s.includes(t))&&(i=at("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):i=at("UNSUPPORTED_CHAINS",`${r}, chains ${e} should be an array of strings conforming to "namespace:chainId" format`),i}function lg(t,e){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const c=ug(i,s==null?void 0:s.chains,`${e} requiredNamespace`);c&&(r=c)}),r}function fg(t,e){let r=null;return ii(t)?t.forEach(i=>{r||cg(i)||(r=at("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=at("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function dg(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=fg(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function pg(t,e){let r=null;return Hn(t==null?void 0:t.methods)?Hn(t==null?void 0:t.events)||(r=at("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=at("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ao(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=pg(i,`${e}, namespace`);s&&(r=s)}),r}function gg(t,e){let r=null;if(t&&Vr(t)){const i=ao(t,e);i&&(r=i);const s=lg(t,e);s&&(r=s)}else r=Q("MISSING_OR_INVALID",`${e}, requiredNamespaces should be an object with data`);return r}function jr(t,e){let r=null;if(t&&Vr(t)){const i=ao(t,e);i&&(r=i);const s=dg(t,e);s&&(r=s)}else r=Q("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function oo(t){return rt(t.protocol,!0)}function yg(t,e){let r=!1;return e&&!t?r=!0:t&&ii(t)&&t.length&&t.forEach(i=>{r=oo(i)}),r}function bg(t){return typeof t=="number"}function pt(t){return typeof t<"u"&&typeof t!==null}function mg(t){return!(!t||typeof t!="object"||!t.code||!us(t.code,!1)||!t.message||!rt(t.message,!1))}function _g(t){return!(Ot(t)||!rt(t.method,!1))}function wg(t){return!(Ot(t)||Ot(t.result)&&Ot(t.error)||!us(t.id,!1)||!rt(t.jsonrpc,!1))}function Eg(t){return!(Ot(t)||!rt(t.name,!1))}function qn(t,e){return!(!ls(e)||!tg(t).includes(e))}function vg(t,e,r){return rt(r,!1)?rg(t,e).includes(r):!1}function Dg(t,e,r){return rt(r,!1)?ig(t,e).includes(r):!1}function Bn(t,e,r){let i=null;const s=Object.keys(t),c=Object.keys(e);return Ut(s,c)?s.forEach(p=>{if(i)return;const h=t[p].chains,f=Or(e[p].accounts);Ut(h,f)?Ut(t[p].methods,e[p].methods)?Ut(t[p].events,e[p].events)||(i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy requiredNamespaces events for ${p}`)):i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy requiredNamespaces methods for ${p}`):i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy requiredNamespaces chains for ${p}`)}):i=Q("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces`),i}function Sg(t,e){return us(t,!1)&&t<=e.max&&t>=e.min}const co="wc",ho=2,uo="client",fs=`${co}@${ho}:${uo}:`,wi={name:uo,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},xg="proposal",Ig="session",$r=J.SEVEN_DAYS,Og="engine",dr={wc_sessionPropose:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1104},res:{ttl:J.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1106},res:{ttl:J.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1112},res:{ttl:J.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1115}}},Ei={min:J.FIVE_MINUTES,max:J.SEVEN_DAYS},Ag="request";var Ng=Object.defineProperty,Tg=Object.defineProperties,Cg=Object.getOwnPropertyDescriptors,Kn=Object.getOwnPropertySymbols,Pg=Object.prototype.hasOwnProperty,Ug=Object.prototype.propertyIsEnumerable,Vn=(t,e,r)=>e in t?Ng(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xt=(t,e)=>{for(var r in e||(e={}))Pg.call(e,r)&&Vn(t,r,e[r]);if(Kn)for(var r of Kn(e))Ug.call(e,r)&&Vn(t,r,e[r]);return t},vi=(t,e)=>Tg(t,Cg(e));class Rg extends Yp{constructor(e){super(e),this.name=Og,this.events=new lt.exports,this.initialized=!1,this.ignoredPayloadTypes=[Zp],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(dr)}),this.initialized=!0)},this.connect=async r=>{this.isInitialized(),await this.isValidConnect(r);const{pairingTopic:i,requiredNamespaces:s,relays:c}=r;let p=i,h,f=!1;if(p&&(f=this.client.core.pairing.pairings.get(p).active),!p||!f){const{topic:I,uri:R}=await this.client.core.pairing.create();p=I,h=R}const _=await this.client.core.crypto.generateKeyPair(),m={requiredNamespaces:s,relays:c!=null?c:[{protocol:so}],proposer:{publicKey:_,metadata:this.client.metadata}},{reject:E,resolve:N,done:v}=Zt();if(this.events.once(We("session_connect"),async({error:I,session:R})=>{if(I)E(I);else if(R){R.self.publicKey=_;const o=vi(xt({},R),{requiredNamespaces:R.requiredNamespaces});await this.client.session.set(R.topic,o),await this.setExpiry(R.topic,R.expiry),p&&await this.client.core.pairing.updateMetadata({topic:p,metadata:R.peer.metadata}),N(o)}}),!p){const{message:I}=Q("NO_MATCHING_KEY",`connect() pairing topic: ${p}`);throw new Error(I)}const D=await this.sendRequest(p,"wc_sessionPropose",m),U=Vt(J.FIVE_MINUTES);return await this.setProposal(D,xt({id:D,expiry:U},m)),{uri:h,approval:v}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:s,namespaces:c}=r,p=this.client.proposal.get(i);let{pairingTopic:h,proposer:f,requiredNamespaces:_}=p;Vr(_)||(_=sg(c,"approve()"),this.client.proposal.set(i,vi(xt({},p),{requiredNamespaces:_})));const m=await this.client.core.crypto.generateKeyPair(),E=f.publicKey,N=await this.client.core.crypto.generateSharedKey(m,E),v={relay:{protocol:s!=null?s:"irn"},namespaces:c,requiredNamespaces:_,controller:{publicKey:m,metadata:this.client.metadata},expiry:Vt($r)};await this.client.core.relayer.subscribe(N);const D=await this.sendRequest(N,"wc_sessionSettle",v),{done:U,resolve:I,reject:R}=Zt();this.events.once(We("session_approve",D),({error:d})=>{d?R(d):I(this.client.session.get(N))});const o=vi(xt({},v),{topic:N,acknowledged:!1,self:v.controller,peer:{publicKey:f.publicKey,metadata:f.metadata},controller:m});return await this.client.session.set(N,o),await this.setExpiry(N,Vt($r)),h&&await this.client.core.pairing.updateMetadata({topic:h,metadata:o.peer.metadata}),h&&i&&(await this.sendResult(i,h,{relay:{protocol:s!=null?s:"irn"},responderPublicKey:m}),await this.client.proposal.delete(i,at("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h})),{topic:N,acknowledged:U}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:s}=r,{pairingTopic:c}=this.client.proposal.get(i);c&&(await this.sendError(i,c,s),await this.client.proposal.delete(i,at("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:s}=r,c=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:s}),{done:p,resolve:h,reject:f}=Zt();return this.events.once(We("session_update",c),({error:_})=>{_?f(_):h()}),await this.client.session.update(i,{namespaces:s}),{acknowledged:p}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,s=await this.sendRequest(i,"wc_sessionExtend",{}),{done:c,resolve:p,reject:h}=Zt();return this.events.once(We("session_extend",s),({error:f})=>{f?h(f):p()}),await this.setExpiry(i,Vt($r)),{acknowledged:c}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:s,topic:c,expiry:p}=r,h=await this.sendRequest(c,"wc_sessionRequest",{request:s,chainId:i},p),{done:f,resolve:_,reject:m}=Zt(p);return this.events.once(We("session_request",h),({error:E,result:N})=>{E?m(E):_(N)}),await f()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:s}=r,{id:c}=s;Pt(s)?await this.sendResult(c,i,s.result):It(s)&&await this.sendError(c,i,s.error),this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const s=await this.sendRequest(i,"wc_sessionPing",{}),{done:c,resolve:p,reject:h}=Zt();this.events.once(We("session_ping",s),({error:f})=>{f?h(f):p()}),await c()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:s,chainId:c}=r;await this.sendRequest(i,"wc_sessionEvent",{event:s,chainId:c})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.client.session.keys.includes(i)?(await this.sendRequest(i,"wc_sessionDelete",at("USER_DISCONNECTED")),await this.deleteSession(i)):await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>og(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(r,i)=>{const{self:s}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),await Promise.all([this.client.session.delete(r,at("USER_DISCONNECTED")),this.client.core.crypto.deleteKeyPair(s.publicKey),this.client.core.crypto.deleteSymKey(r),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,at("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),s?Promise.resolve():this.client.core.expirer.del(r)])},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=dr.wc_sessionRequest.req.ttl,{id:s,topic:c,params:p}=r;await this.client.pendingRequest.set(s,{id:s,topic:c,params:p}),i&&this.client.core.expirer.set(s,Vt(i))},this.sendRequest=async(r,i,s,c)=>{const p=Wi(i,s),h=await this.client.core.crypto.encode(r,p),f=dr[i].req;return c&&(f.ttl=c),this.client.core.history.set(r,p),this.client.core.relayer.publish(r,h,f),p.id},this.sendResult=async(r,i,s)=>{const c=ki(r,s),p=await this.client.core.crypto.encode(i,c),h=await this.client.core.history.get(i,r),f=dr[h.request.method].res;this.client.core.relayer.publish(i,p,f),await this.client.core.history.resolve(c)},this.sendError=async(r,i,s)=>{const c=Vi(r,s),p=await this.client.core.crypto.encode(i,c),h=await this.client.core.history.get(i,r),f=dr[h.request.method].res;this.client.core.relayer.publish(i,p,f),await this.client.core.history.resolve(c)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(s=>{Xt(s.expiry)&&r.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Xt(s.expiry)&&i.push(s.id)}),await Promise.all([...r.map(s=>this.deleteSession(s)),...i.map(s=>this.deleteProposal(s))])},this.onRelayEventRequest=r=>{const{topic:i,payload:s}=r,c=s.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeRequest(i,s);case"wc_sessionSettle":return this.onSessionSettleRequest(i,s);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,s);case"wc_sessionExtend":return this.onSessionExtendRequest(i,s);case"wc_sessionPing":return this.onSessionPingRequest(i,s);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,s);case"wc_sessionRequest":return this.onSessionRequest(i,s);case"wc_sessionEvent":return this.onSessionEventRequest(i,s);default:return this.client.logger.info(`Unsupported request method ${c}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:s}=r,c=(await this.client.core.history.get(i,s.id)).request.method;switch(c){case"wc_sessionPropose":return this.onSessionProposeResponse(i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,s);case"wc_sessionExtend":return this.onSessionExtendResponse(i,s);case"wc_sessionPing":return this.onSessionPingResponse(i,s);case"wc_sessionRequest":return this.onSessionRequestResponse(i,s);default:return this.client.logger.info(`Unsupported response method ${c}`)}},this.onSessionProposeRequest=async(r,i)=>{const{params:s,id:c}=i;try{this.isValidConnect(xt({},i.params));const p=Vt(J.FIVE_MINUTES),h=xt({id:c,pairingTopic:r,expiry:p},s);await this.setProposal(c,h),this.client.events.emit("session_proposal",{id:c,params:h})}catch(p){await this.sendError(c,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,i)=>{const{id:s}=i;if(Pt(i)){const{result:c}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:c});const p=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const h=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:h});const f=c.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:f});const _=await this.client.core.crypto.generateSharedKey(h,f);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:_});const m=await this.client.core.relayer.subscribe(_);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:m}),await this.client.core.pairing.activate({topic:r})}else It(i)&&(await this.client.proposal.delete(s,at("USER_DISCONNECTED")),this.events.emit(We("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidSessionSettleRequest(c);const{relay:p,controller:h,expiry:f,namespaces:_,requiredNamespaces:m}=i.params,E={topic:r,relay:p,expiry:f,namespaces:_,acknowledged:!0,requiredNamespaces:m,controller:h.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:h.publicKey,metadata:h.metadata}};await this.sendResult(i.id,r,!0),this.events.emit(We("session_connect"),{session:E})}catch(p){await this.sendError(s,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,i)=>{const{id:s}=i;Pt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(We("session_approve",s),{})):It(i)&&(await this.client.session.delete(r,at("USER_DISCONNECTED")),this.events.emit(We("session_approve",s),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:s,id:c}=i;try{this.isValidUpdate(xt({topic:r},s)),await this.client.session.update(r,{namespaces:s.namespaces}),await this.sendResult(c,r,!0),this.client.events.emit("session_update",{id:c,topic:r,params:s})}catch(p){await this.sendError(c,r,p),this.client.logger.error(p)}},this.onSessionUpdateResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(We("session_update",s),{}):It(i)&&this.events.emit(We("session_update",s),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:s}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Vt($r)),await this.sendResult(s,r,!0),this.client.events.emit("session_extend",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionExtendResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(We("session_extend",s),{}):It(i)&&this.events.emit(We("session_extend",s),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.client.events.emit("session_ping",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionPingResponse=(r,i)=>{const{id:s}=i;setTimeout(()=>{Pt(i)?this.events.emit(We("session_ping",s),{}):It(i)&&this.events.emit(We("session_ping",s),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),this.client.core.relayer.once(et.publish,async()=>{await this.deleteSession(r)}),await this.sendResult(s,r,!0),this.client.events.emit("session_delete",{id:s,topic:r})}catch(c){await this.sendError(s,r,c),this.client.logger.error(c)}},this.onSessionRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidRequest(xt({topic:r},c)),await this.setPendingSessionRequest({id:s,topic:r,params:c}),this.client.events.emit("session_request",{id:s,topic:r,params:c})}catch(p){await this.sendError(s,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,i)=>{const{id:s}=i;Pt(i)?this.events.emit(We("session_request",s),{result:i.result}):It(i)&&this.events.emit(We("session_request",s),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:s,params:c}=i;try{this.isValidEmit(xt({topic:r},c)),this.client.events.emit("session_event",{id:s,topic:r,params:c})}catch(p){await this.sendError(s,r,p),this.client.logger.error(p)}},this.isValidConnect=async r=>{if(!pt(r)){const{message:h}=Q("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:s,relays:c}=r;if(Ot(i)||await this.isValidPairingTopic(i),!Ot(s)&&Vr(s)===0)return;const p=gg(s,"connect()");if(p)throw new Error(p.message);if(!yg(c,!0)){const{message:h}=Q("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}},this.isValidApprove=async r=>{if(!pt(r))throw new Error(Q("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:s,relayProtocol:c}=r;await this.isValidProposalId(i);const p=this.client.proposal.get(i),h=jr(s,"approve()");if(h)throw new Error(h.message);const f=Bn(p.requiredNamespaces,s,"update()");if(f)throw new Error(f.message);if(!rt(c,!0)){const{message:_}=Q("MISSING_OR_INVALID",`approve() relayProtocol: ${c}`);throw new Error(_)}},this.isValidReject=async r=>{if(!pt(r)){const{message:c}=Q("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(c)}const{id:i,reason:s}=r;if(await this.isValidProposalId(i),!mg(s)){const{message:c}=Q("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidSessionSettleRequest=r=>{if(!pt(r)){const{message:_}=Q("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(_)}const{relay:i,controller:s,namespaces:c,expiry:p}=r;if(!oo(i)){const{message:_}=Q("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(_)}const h=hg(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);const f=jr(c,"onSessionSettleRequest()");if(f)throw new Error(f.message);if(Xt(p)){const{message:_}=Q("EXPIRED","onSessionSettleRequest()");throw new Error(_)}},this.isValidUpdate=async r=>{if(!pt(r)){const{message:f}=Q("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(f)}const{topic:i,namespaces:s}=r;await this.isValidSessionTopic(i);const c=this.client.session.get(i),p=jr(s,"update()");if(p)throw new Error(p.message);const h=Bn(c.requiredNamespaces,s,"update()");if(h)throw new Error(h.message)},this.isValidExtend=async r=>{if(!pt(r)){const{message:s}=Q("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!pt(r)){const{message:f}=Q("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(f)}const{topic:i,request:s,chainId:c,expiry:p}=r;await this.isValidSessionTopic(i);const{namespaces:h}=this.client.session.get(i);if(!qn(h,c)){const{message:f}=Q("MISSING_OR_INVALID",`request() chainId: ${c}`);throw new Error(f)}if(!_g(s)){const{message:f}=Q("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(f)}if(!vg(h,c,s.method)){const{message:f}=Q("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(f)}if(p&&!Sg(p,Ei)){const{message:f}=Q("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${Ei.min} and ${Ei.max}`);throw new Error(f)}},this.isValidRespond=async r=>{if(!pt(r)){const{message:c}=Q("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(c)}const{topic:i,response:s}=r;if(await this.isValidSessionTopic(i),!wg(s)){const{message:c}=Q("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(c)}},this.isValidPing=async r=>{if(!pt(r)){const{message:s}=Q("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!pt(r)){const{message:h}=Q("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(h)}const{topic:i,event:s,chainId:c}=r;await this.isValidSessionTopic(i);const{namespaces:p}=this.client.session.get(i);if(!qn(p,c)){const{message:h}=Q("MISSING_OR_INVALID",`emit() chainId: ${c}`);throw new Error(h)}if(!Eg(s)){const{message:h}=Q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}if(!Dg(p,c,s.name)){const{message:h}=Q("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(h)}},this.isValidDisconnect=async r=>{if(!pt(r)){const{message:s}=Q("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)}}isInitialized(){if(!this.initialized){const{message:e}=Q("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(et.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const s=await this.client.core.crypto.decode(r,i);Gi(s)?(this.client.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):ea(s)&&(await this.client.core.history.resolve(s),this.onRelayEventResponse({topic:r,payload:s}))})}registerExpirerEvents(){this.client.core.expirer.on(ut.expired,async e=>{const{topic:r,id:i}=eg(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,Q("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!rt(e,!1)){const{message:r}=Q("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=Q("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Xt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=Q("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!rt(e,!1)){const{message:r}=Q("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=Q("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Xt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=Q("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(rt(e,!1)){const{message:r}=Q("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=Q("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!bg(e)){const{message:r}=Q("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=Q("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Xt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=Q("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class Fg extends ri{constructor(e,r){super(e,r,xg,fs),this.core=e,this.logger=r}}class Mg extends ri{constructor(e,r){super(e,r,Ig,fs),this.core=e,this.logger=r}}class Lg extends ri{constructor(e,r){super(e,r,Ag,fs),this.core=e,this.logger=r}}class ds extends Wp{constructor(e){super(e),this.protocol=co,this.version=ho,this.name=wi.name,this.events=new lt.exports.EventEmitter,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(s){throw this.logger.error(s.message),s}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(s){throw this.logger.error(s.message),s}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(s){throw this.logger.error(s.message),s}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(s){throw this.logger.error(s.message),s}},this.update=async i=>{try{return await this.engine.update(i)}catch(s){throw this.logger.error(s.message),s}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(s){throw this.logger.error(s.message),s}},this.request=async i=>{try{return await this.engine.request(i)}catch(s){throw this.logger.error(s.message),s}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(s){throw this.logger.error(s.message),s}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(s){throw this.logger.error(s.message),s}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(s){throw this.logger.error(s.message),s}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(s){throw this.logger.error(s.message),s}},this.find=i=>{try{return this.engine.find(i)}catch(s){throw this.logger.error(s.message),s}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||wi.name,this.metadata=(e==null?void 0:e.metadata)||Qp();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:wr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||wi.logger}));this.core=(e==null?void 0:e.core)||new kp(e),this.logger=Se.generateChildLogger(r,this.name),this.session=new Mg(this.core,this.logger),this.proposal=new Fg(this.core,this.logger),this.pendingRequest=new Lg(this.core,this.logger),this.engine=new Rg(this)}static async init(e){const r=new ds(e);return await r.initialize(),r}get context(){return Se.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}var ps={};Object.defineProperty(ps,"__esModule",{value:!0});ps.getWindowMetadata=void 0;const Gn=Hi;function $g(){let t,e;try{t=Gn.getDocumentOrThrow(),e=Gn.getLocationOrThrow()}catch{return null}function r(){const E=t.getElementsByTagName("link"),N=[];for(let v=0;v<E.length;v++){const D=E[v],U=D.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const I=D.getAttribute("href");if(I)if(I.toLowerCase().indexOf("https:")===-1&&I.toLowerCase().indexOf("http:")===-1&&I.indexOf("//")!==0){let R=e.protocol+"//"+e.host;if(I.indexOf("/")===0)R+=I;else{const o=e.pathname.split("/");o.pop();const d=o.join("/");R+=d+"/"+I}N.push(R)}else if(I.indexOf("//")===0){const R=e.protocol+I;N.push(R)}else N.push(I)}}return N}function i(...E){const N=t.getElementsByTagName("meta");for(let v=0;v<N.length;v++){const D=N[v],U=["itemprop","property","name"].map(I=>D.getAttribute(I)).filter(I=>I?E.includes(I):!1);if(U.length&&U){const I=D.getAttribute("content");if(I)return I}}return""}function s(){let E=i("name","og:site_name","og:title","twitter:title");return E||(E=t.title),E}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),h=c(),f=e.origin,_=r();return{description:h,url:f,icons:_,name:p}}ps.getWindowMetadata=$g;var jg={};(function(t){const e=Bi,r=Ki,i=qi,s=is,c=o=>o==null,p=Symbol("encodeFragmentIdentifier");function h(o){switch(o.arrayFormat){case"index":return d=>(u,l)=>{const y=u.length;return l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[",y,"]"].join("")]:[...u,[m(d,o),"[",m(y,o),"]=",m(l,o)].join("")]};case"bracket":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),"[]"].join("")]:[...u,[m(d,o),"[]=",m(l,o)].join("")];case"colon-list-separator":return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,[m(d,o),":list="].join("")]:[...u,[m(d,o),":list=",m(l,o)].join("")];case"comma":case"separator":case"bracket-separator":{const d=o.arrayFormat==="bracket-separator"?"[]=":"=";return u=>(l,y)=>y===void 0||o.skipNull&&y===null||o.skipEmptyString&&y===""?l:(y=y===null?"":y,l.length===0?[[m(u,o),d,m(y,o)].join("")]:[[l,m(y,o)].join(o.arrayFormatSeparator)])}default:return d=>(u,l)=>l===void 0||o.skipNull&&l===null||o.skipEmptyString&&l===""?u:l===null?[...u,m(d,o)]:[...u,[m(d,o),"=",m(l,o)].join("")]}}function f(o){let d;switch(o.arrayFormat){case"index":return(u,l,y)=>{if(d=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),!d){y[u]=l;return}y[u]===void 0&&(y[u]={}),y[u][d[1]]=l};case"bracket":return(u,l,y)=>{if(d=/(\[\])$/.exec(u),u=u.replace(/\[\]$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"colon-list-separator":return(u,l,y)=>{if(d=/(:list)$/.exec(u),u=u.replace(/:list$/,""),!d){y[u]=l;return}if(y[u]===void 0){y[u]=[l];return}y[u]=[].concat(y[u],l)};case"comma":case"separator":return(u,l,y)=>{const n=typeof l=="string"&&l.includes(o.arrayFormatSeparator),g=typeof l=="string"&&!n&&E(l,o).includes(o.arrayFormatSeparator);l=g?E(l,o):l;const P=n||g?l.split(o.arrayFormatSeparator).map(j=>E(j,o)):l===null?l:E(l,o);y[u]=P};case"bracket-separator":return(u,l,y)=>{const n=/(\[\])$/.test(u);if(u=u.replace(/\[\]$/,""),!n){y[u]=l&&E(l,o);return}const g=l===null?[]:l.split(o.arrayFormatSeparator).map(P=>E(P,o));if(y[u]===void 0){y[u]=g;return}y[u]=[].concat(y[u],g)};default:return(u,l,y)=>{if(y[u]===void 0){y[u]=l;return}y[u]=[].concat(y[u],l)}}}function _(o){if(typeof o!="string"||o.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function m(o,d){return d.encode?d.strict?e(o):encodeURIComponent(o):o}function E(o,d){return d.decode?r(o):o}function N(o){return Array.isArray(o)?o.sort():typeof o=="object"?N(Object.keys(o)).sort((d,u)=>Number(d)-Number(u)).map(d=>o[d]):o}function v(o){const d=o.indexOf("#");return d!==-1&&(o=o.slice(0,d)),o}function D(o){let d="";const u=o.indexOf("#");return u!==-1&&(d=o.slice(u)),d}function U(o){o=v(o);const d=o.indexOf("?");return d===-1?"":o.slice(d+1)}function I(o,d){return d.parseNumbers&&!Number.isNaN(Number(o))&&typeof o=="string"&&o.trim()!==""?o=Number(o):d.parseBooleans&&o!==null&&(o.toLowerCase()==="true"||o.toLowerCase()==="false")&&(o=o.toLowerCase()==="true"),o}function R(o,d){d=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},d),_(d.arrayFormatSeparator);const u=f(d),l=Object.create(null);if(typeof o!="string"||(o=o.trim().replace(/^[?#&]/,""),!o))return l;for(const y of o.split("&")){if(y==="")continue;let[n,g]=i(d.decode?y.replace(/\+/g," "):y,"=");g=g===void 0?null:["comma","separator","bracket-separator"].includes(d.arrayFormat)?g:E(g,d),u(E(n,d),g,l)}for(const y of Object.keys(l)){const n=l[y];if(typeof n=="object"&&n!==null)for(const g of Object.keys(n))n[g]=I(n[g],d);else l[y]=I(n,d)}return d.sort===!1?l:(d.sort===!0?Object.keys(l).sort():Object.keys(l).sort(d.sort)).reduce((y,n)=>{const g=l[n];return Boolean(g)&&typeof g=="object"&&!Array.isArray(g)?y[n]=N(g):y[n]=g,y},Object.create(null))}t.extract=U,t.parse=R,t.stringify=(o,d)=>{if(!o)return"";d=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},d),_(d.arrayFormatSeparator);const u=g=>d.skipNull&&c(o[g])||d.skipEmptyString&&o[g]==="",l=h(d),y={};for(const g of Object.keys(o))u(g)||(y[g]=o[g]);const n=Object.keys(y);return d.sort!==!1&&n.sort(d.sort),n.map(g=>{const P=o[g];return P===void 0?"":P===null?m(g,d):Array.isArray(P)?P.length===0&&d.arrayFormat==="bracket-separator"?m(g,d)+"[]":P.reduce(l(g),[]).join("&"):m(g,d)+"="+m(P,d)}).filter(g=>g.length>0).join("&")},t.parseUrl=(o,d)=>{d=Object.assign({decode:!0},d);const[u,l]=i(o,"#");return Object.assign({url:u.split("?")[0]||"",query:R(U(o),d)},d&&d.parseFragmentIdentifier&&l?{fragmentIdentifier:E(l,d)}:{})},t.stringifyUrl=(o,d)=>{d=Object.assign({encode:!0,strict:!0,[p]:!0},d);const u=v(o.url).split("?")[0]||"",l=t.extract(o.url),y=t.parse(l,{sort:!1}),n=Object.assign(y,o.query);let g=t.stringify(n,d);g&&(g=`?${g}`);let P=D(o.url);return o.fragmentIdentifier&&(P=`#${d[p]?m(o.fragmentIdentifier,d):o.fragmentIdentifier}`),`${u}${g}${P}`},t.pick=(o,d,u)=>{u=Object.assign({parseFragmentIdentifier:!0,[p]:!1},u);const{url:l,query:y,fragmentIdentifier:n}=t.parseUrl(o,u);return t.stringifyUrl({url:l,query:s(y,d),fragmentIdentifier:n},u)},t.exclude=(o,d,u)=>{const l=Array.isArray(d)?y=>!d.includes(y):(y,n)=>!d(y,n);return t.pick(o,l,u)}})(jg);const zg={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}};function Hg(t,e){const{message:r,code:i}=zg[t];return{message:e?`${r} ${e}`:r,code:i}}function qg(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Bg(t){var e;const r=(e=t[Object.keys(t)[0]])==null?void 0:e.chains[0];return[r.split(":")[0],r.split(":")[1]]}function Ft(t,e){let r;return e.rpcMap&&(r=e.rpcMap[Kg([t])]),r}function Kg(t){return Number(t[0].split(":")[1])}class Vg{constructor(e){this.name="eip155",this.namespace=e.namespace,this.client=e.client,this.events=e.events,this.httpProviders=this.createHttpProviders(),this.chainId=this.getDefaultChainId()}async request(e){var r;switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":{const i=e.request.params?(r=e.request.params[0])==null?void 0:r.chainId:"0x0";return this.setDefaultChain(parseInt(i,16).toString()),null}case"eth_chainId":return this.getDefaultChainId()}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,r){if(this.chainId=parseInt(e),!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}requestAccounts(){return this.getAccounts()}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new _r(new Gr(i))}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return parseInt(e.split(":")[1])}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}}class Gg{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new _r(new Gr(i))}}class kg{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new _r(new Gr(i))}}class Wg{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=e.events,this.client=e.client,this.chainId=this.getDefaultChainId(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getAccounts(){const e=this.namespace.accounts;return e?e.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(r=>{e[r]=this.createHttpProvider(r)}),e}getDefaultChainId(){if(this.chainId)return this.chainId;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}getHttpProvider(){const e=`${this.name}:${this.chainId}`,r=this.httpProviders[e];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setDefaultChain(e,r){if(this.chainId=e,!this.httpProviders[e]){const i=r||Ft(`${this.name}:${e}`,this.namespace);if(!i)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,i)}this.events.emit("chainChanged",this.chainId)}setHttpProvider(e,r){const i=this.createHttpProvider(e,r);i&&(this.httpProviders[e]=i)}createHttpProvider(e,r){const i=r||Ft(e,this.namespace);return typeof i>"u"?void 0:new _r(new Gr(i))}}const kn="error",Yg="wss://relay.walletconnect.com",Jg="wc",Xg="universal_provider",Wn=`${Jg}@${2}:${Xg}:`;var Zg=Object.defineProperty,Qg=Object.defineProperties,e0=Object.getOwnPropertyDescriptors,Yn=Object.getOwnPropertySymbols,t0=Object.prototype.hasOwnProperty,r0=Object.prototype.propertyIsEnumerable,Jn=(t,e,r)=>e in t?Zg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xn=(t,e)=>{for(var r in e||(e={}))t0.call(e,r)&&Jn(t,r,e[r]);if(Yn)for(var r of Yn(e))r0.call(e,r)&&Jn(t,r,e[r]);return t},i0=(t,e)=>Qg(t,e0(e));class gs{constructor(e){this.events=new lt.exports,this.rpcProviders={},this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:wr(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||kn}))}static async init(e){const r=new gs(e);return await r.initialize(),r}async request(e,r){const[i,s]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Xn({},e),chainId:`${i}:${s}`,topic:this.session.topic})}sendAsync(e,r,i){this.request(e,i).then(s=>r(null,s)).catch(s=>r(s,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Hg("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");const{namespaces:r}=e;return this.setNamespaces(r),this.createProviders(),await this.cleanupPendingPairings(),e.skipPairing===!0?void 0:await this.pair(e.pairingTopic)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}removeListener(e,r){this.events.removeListener(e,r)}off(e,r){this.events.off(e,r)}get isWalletConnect(){return!0}async pair(e){const{uri:r,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces});return r&&(this.uri=r,this.events.emit("display_uri",r)),this.session=await i(),this.onSessionUpdate(),this.onConnect(),this.session}setDefaultChain(e,r){try{const[i,s]=this.validateChain(e);this.getProvider(i).setDefaultChain(s,r)}catch(i){if(!/Please call connect/.test(i.message))throw i}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(qg(r)){for(const i of r)e.deletePairings?this.client.core.expirer.set(i.topic,0):await this.client.core.relayer.subscriber.unsubscribe(i.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}async checkStorage(){if(this.namespaces=await this.client.core.storage.getItem(`${Wn}/namespaces`)||{},this.namespaces&&this.createProviders(),this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.onSessionUpdate()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await ds.init({logger:this.providerOpts.logger||kn,relayUrl:this.providerOpts.relayUrl||Yg,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");Object.keys(this.namespaces).forEach(e=>{switch(e){case"eip155":this.rpcProviders[e]=new Vg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"solana":this.rpcProviders[e]=new Gg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"cosmos":this.rpcProviders[e]=new kg({client:this.client,namespace:this.namespaces[e],events:this.events});break;case"polkadot":break;case"cip34":this.rpcProviders[e]=new Wg({client:this.client,namespace:this.namespaces[e],events:this.events});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:r}=e,{event:i}=r;i.name==="accountsChanged"?this.events.emit("accountsChanged",i.data):i.name==="chainChanged"?this.onChainChanged(i.data,r.chainId):this.events.emit(i.name,i.data),this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:r})=>{var i;const{namespaces:s}=r,c=(i=this.client)==null?void 0:i.session.get(e);this.session=i0(Xn({},c),{namespaces:s}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:r})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e)})}getProvider(e){if(!this.rpcProviders[e])throw new Error(`Provider not found: ${e}`);return this.rpcProviders[e]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var r;this.getProvider(e).updateNamespace((r=this.session)==null?void 0:r.namespaces[e])})}setNamespaces(e){if(!e||!Object.keys(e).length)throw new Error("Namespaces must be not empty");this.client.core.storage.setItem(`${Wn}/namespaces`,e),this.namespaces=e}validateChain(e){const[r,i]=(e==null?void 0:e.split(":"))||["",""];if(r&&!Object.keys(this.namespaces).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);return!r||!i?Bg(this.namespaces):[r,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,r){const[i,s]=this.validateChain(r);this.getProvider(i).setDefaultChain(s),this.events.emit("chainChanged",e)}onConnect(){this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,await this.cleanupPendingPairings({deletePairings:!0})}}const o0=gs;export{o0 as UniversalProvider,gs as default};
